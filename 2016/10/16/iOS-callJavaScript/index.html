<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="iOS,Swift,OC,JavaScript,JavaScriptCore,UIWebView,WKWebView,HTML,WebKit," />










<meta name="description" content="OC/Swiftä¸JavaScriptäº¤äº’é—®é¢˜ iOSä¸­å¦‚ä½•åŠ è½½HTMLé¡µé¢ï¼Ÿï¼ˆåŒ…æ‹¬Objective-Cå’ŒSwiftï¼‰ iOSä¸­å¦‚ä½•å»æ‰§è¡Œä¸€æ®µJavaScriptä»£ç ï¼Ÿï¼ˆåŒ…æ‹¬Objective-Cå’ŒSwiftï¼‰ iOSä¸­ä¸ºä»€ä¹ˆè¦ä½¿ç”¨åŸç”Ÿè¯­è¨€å»æ‰§è¡Œä¸€æ®µJavaScriptä»£ç ï¼Ÿ iOSä¸­å¦‚ä½•ç›‘å¬åˆ°HTMLé¡µé¢ä¸­è§¦å‘çš„äº‹ä»¶ï¼Ÿï¼ˆJavaScriptå‡½æ•°çš„è§¦å‘ï¼‰ iOSæ··åˆå¼€å‘ä¸­ï¼Œå½“JavaScript">
<meta name="keywords" content="iOS,Swift,OC,JavaScript,JavaScriptCore,UIWebView,WKWebView,HTML,WebKit">
<meta property="og:type" content="article">
<meta property="og:title" content="Objective-C&#x2F;Swiftä¸JavaScriptäº¤äº’">
<meta property="og:url" content="http://www.mengyueping.com/2016/10/16/iOS-callJavaScript/index.html">
<meta property="og:site_name" content="å­Ÿè·ƒå¹³çš„æŠ€æœ¯åšå®¢">
<meta property="og:description" content="OC/Swiftä¸JavaScriptäº¤äº’é—®é¢˜ iOSä¸­å¦‚ä½•åŠ è½½HTMLé¡µé¢ï¼Ÿï¼ˆåŒ…æ‹¬Objective-Cå’ŒSwiftï¼‰ iOSä¸­å¦‚ä½•å»æ‰§è¡Œä¸€æ®µJavaScriptä»£ç ï¼Ÿï¼ˆåŒ…æ‹¬Objective-Cå’ŒSwiftï¼‰ iOSä¸­ä¸ºä»€ä¹ˆè¦ä½¿ç”¨åŸç”Ÿè¯­è¨€å»æ‰§è¡Œä¸€æ®µJavaScriptä»£ç ï¼Ÿ iOSä¸­å¦‚ä½•ç›‘å¬åˆ°HTMLé¡µé¢ä¸­è§¦å‘çš„äº‹ä»¶ï¼Ÿï¼ˆJavaScriptå‡½æ•°çš„è§¦å‘ï¼‰ iOSæ··åˆå¼€å‘ä¸­ï¼Œå½“JavaScript">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2017-07-01T16:00:00.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Objective-C&#x2F;Swiftä¸JavaScriptäº¤äº’">
<meta name="twitter:description" content="OC/Swiftä¸JavaScriptäº¤äº’é—®é¢˜ iOSä¸­å¦‚ä½•åŠ è½½HTMLé¡µé¢ï¼Ÿï¼ˆåŒ…æ‹¬Objective-Cå’ŒSwiftï¼‰ iOSä¸­å¦‚ä½•å»æ‰§è¡Œä¸€æ®µJavaScriptä»£ç ï¼Ÿï¼ˆåŒ…æ‹¬Objective-Cå’ŒSwiftï¼‰ iOSä¸­ä¸ºä»€ä¹ˆè¦ä½¿ç”¨åŸç”Ÿè¯­è¨€å»æ‰§è¡Œä¸€æ®µJavaScriptä»£ç ï¼Ÿ iOSä¸­å¦‚ä½•ç›‘å¬åˆ°HTMLé¡µé¢ä¸­è§¦å‘çš„äº‹ä»¶ï¼Ÿï¼ˆJavaScriptå‡½æ•°çš„è§¦å‘ï¼‰ iOSæ··åˆå¼€å‘ä¸­ï¼Œå½“JavaScript">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.mengyueping.com/2016/10/16/iOS-callJavaScript/"/>





  <title>Objective-C/Swiftä¸JavaScriptäº¤äº’ | å­Ÿè·ƒå¹³çš„æŠ€æœ¯åšå®¢</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?deacc15534ffb9510cfb94bae354ea45";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">å­Ÿè·ƒå¹³çš„æŠ€æœ¯åšå®¢</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            å…³äº
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.mengyueping.com/2016/10/16/iOS-callJavaScript/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="å­Ÿè·ƒå¹³">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å­Ÿè·ƒå¹³çš„æŠ€æœ¯åšå®¢">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Objective-C/Swiftä¸JavaScriptäº¤äº’</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2016-10-16T00:00:00+08:00">
                2016-10-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                
                  ï¼Œ 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/JavaScriptCore/" itemprop="url" rel="index">
                    <span itemprop="name">JavaScriptCore</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/10/16/iOS-callJavaScript/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/10/16/iOS-callJavaScript/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2016/10/16/iOS-callJavaScript/" class="leancloud_visitors" data-flag-title="Objective-C/Swiftä¸JavaScriptäº¤äº’">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="OC-Swiftä¸JavaScriptäº¤äº’"><a href="#OC-Swiftä¸JavaScriptäº¤äº’" class="headerlink" title="OC/Swiftä¸JavaScriptäº¤äº’"></a>OC/Swiftä¸JavaScriptäº¤äº’</h1><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><ul>
<li><code>iOS</code>ä¸­å¦‚ä½•åŠ è½½<code>HTML</code>é¡µé¢ï¼Ÿï¼ˆåŒ…æ‹¬<code>Objective-C</code>å’Œ<code>Swift</code>ï¼‰</li>
<li><code>iOS</code>ä¸­å¦‚ä½•å»æ‰§è¡Œä¸€æ®µ<code>JavaScript</code>ä»£ç ï¼Ÿï¼ˆåŒ…æ‹¬<code>Objective-C</code>å’Œ<code>Swift</code>ï¼‰</li>
<li><code>iOS</code>ä¸­ä¸ºä»€ä¹ˆè¦ä½¿ç”¨åŸç”Ÿè¯­è¨€å»æ‰§è¡Œä¸€æ®µ<code>JavaScript</code>ä»£ç ï¼Ÿ</li>
<li><code>iOS</code>ä¸­å¦‚ä½•ç›‘å¬åˆ°<code>HTML</code>é¡µé¢ä¸­è§¦å‘çš„äº‹ä»¶ï¼Ÿï¼ˆ<code>JavaScript</code>å‡½æ•°çš„è§¦å‘ï¼‰</li>
<li><code>iOS</code>æ··åˆå¼€å‘ä¸­ï¼Œå½“<code>JavaScript</code>å‡½æ•°è§¦å‘æ—¶ï¼Œèƒ½å¦å‘é€ä¸€äº›æ•°æ®ç»™<code>iOS</code>åŸç”Ÿï¼Œå¦‚ä½•å‘é€ï¼Ÿ</li>
<li><code>iOS</code>æ··åˆå¼€å‘ä¸­ï¼Œå½“<code>JavaScript</code>å‡½æ•°è§¦å‘æ—¶ï¼Œèƒ½å¦è®©<code>OC/Swift</code>æ‰§è¡Œä¸€äº›æ“ä½œï¼Œæ¯”å¦‚è°ƒç”¨ç³»ç»Ÿç›¸æœºç­‰ï¼Ÿ<a id="more"></a>
</li>
</ul>
<h1 id="iOSä¸­åŠ è½½HTMLé¡µé¢"><a href="#iOSä¸­åŠ è½½HTMLé¡µé¢" class="headerlink" title="iOSä¸­åŠ è½½HTMLé¡µé¢"></a>iOSä¸­åŠ è½½HTMLé¡µé¢</h1><h2 id="UIWebView"><a href="#UIWebView" class="headerlink" title="UIWebView"></a>UIWebView</h2><h3 id="OCç‰ˆæœ¬"><a href="#OCç‰ˆæœ¬" class="headerlink" title="OCç‰ˆæœ¬"></a>OCç‰ˆæœ¬</h3><p><code>UIWebView</code>æ˜¯<code>iOS 2.0</code>å°±æœ‰çš„ä¸€ä¸ªUIæ§ä»¶ï¼Œæ˜¯ç”¨æ¥åŠ è½½<code>HTML</code>é¡µé¢çš„ï¼Œå±äº<code>UIKit</code>æ¡†æ¶ã€‚åŸºæœ¬ä½¿ç”¨æ¯”è¾ƒç®€å•ï¼Œä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//UIæ§ä»¶è®¾ç½®</span><br><span class="line">  UIWebView *webView = [[UIWebView alloc] initWithFrame:self.view.bounds];</span><br><span class="line">  webView.delegate = self;</span><br><span class="line">  [self.view addSubview:webView];</span><br><span class="line">  NSURL *htmlUrl = [NSURL URLWithString:@&quot;https://www.baidu.com&quot;];</span><br><span class="line">  NSURLRequest *request = [NSURLRequest requestWithURL:htmlUrl];</span><br><span class="line">  [webView loadRequest:request];</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// å®ç°ä»£ç† UIWebViewDelegate</span><br><span class="line">- (void)webViewDidStartLoad:(UIWebView *)webView&#123;</span><br><span class="line">	//ç½‘é¡µå¼€å§‹åŠ è½½æ—¶è°ƒç”¨</span><br><span class="line">&#125;</span><br><span class="line">- (void)webViewDidFinishLoad:(UIWebView *)webView&#123;</span><br><span class="line">	//ç½‘é¡µåŠ è½½å®Œæˆæ—¶è°ƒç”¨</span><br><span class="line">&#125;</span><br><span class="line">- (void)webView:(UIWebView *)webView didFailLoadWithError:(NSError *)error&#123;</span><br><span class="line">	//ç½‘é¡µåŠ è½½å¤±è´¥æ—¶è°ƒç”¨</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Swiftç‰ˆæœ¬"><a href="#Swiftç‰ˆæœ¬" class="headerlink" title="Swiftç‰ˆæœ¬"></a>Swiftç‰ˆæœ¬</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//UIæ§ä»¶è®¾ç½®</span></span><br><span class="line">  <span class="keyword">let</span> webView = <span class="type">UIWebView</span>(frame: view.bounds)</span><br><span class="line">  webView.delegate = <span class="keyword">self</span></span><br><span class="line">  view.addSubview(webView)</span><br><span class="line">  <span class="keyword">let</span> url = <span class="type">URL</span>(string: <span class="string">"https://www.baidu.com"</span>)!</span><br><span class="line">  webView.loadRequest(<span class="type">URLRequest</span>(url: url))</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®ç°ä»£ç† UIWebViewDelegate</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ViewController</span>: <span class="title">UIWebViewDelegate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">webViewDidStartLoad</span><span class="params">(<span class="number">_</span> webView: UIWebView)</span></span> &#123;</span><br><span class="line">        <span class="comment">//ç½‘é¡µå¼€å§‹åŠ è½½æ—¶è°ƒç”¨</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">webViewDidFinishLoad</span><span class="params">(<span class="number">_</span> webView: UIWebView)</span></span> &#123;</span><br><span class="line">        <span class="comment">//ç½‘é¡µåŠ è½½å®Œæˆæ—¶è°ƒç”¨</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(<span class="number">_</span> webView: UIWebView, didFailLoadWithError error: Error)</span></span> &#123;</span><br><span class="line">        <span class="comment">//ç½‘é¡µåŠ è½½å¤±è´¥æ—¶è°ƒç”¨</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="WKWebView"><a href="#WKWebView" class="headerlink" title="WKWebView"></a>WKWebView</h2><h3 id="OCç‰ˆæœ¬-1"><a href="#OCç‰ˆæœ¬-1" class="headerlink" title="OCç‰ˆæœ¬"></a>OCç‰ˆæœ¬</h3><p><code>WKWebView</code>æ˜¯<code>iOS 8.0</code>å‡ºç°çš„ä¸€ä¸ªUIæ§ä»¶ï¼Œæ˜¯ç”¨æ¥åŠ è½½<code>HTML</code>é¡µé¢çš„ï¼Œå±äº<code>WebKit</code>æ¡†æ¶ã€‚åŸºæœ¬ä½¿ç”¨ï¼Œä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">WKWebViewConfiguration *configuration = [[WKWebViewConfiguration alloc] init];</span><br><span class="line">WKWebView *webView = [[WKWebView alloc] initWithFrame:self.view.bounds configuration:configuration];</span><br><span class="line">webView.UIDelegate = self;</span><br><span class="line">webView.navigationDelegate = self;</span><br><span class="line">[self.view addSubview:webView];</span><br><span class="line">NSURL *url = [NSURL URLWithString:@&quot;https://www.baidu.com&quot;];</span><br><span class="line">[webView loadRequest:[NSURLRequest requestWithURL:url]];</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">//éœ€è¦éµå®ˆåè®® WKNavigationDelegate, WKUIDelegate</span><br><span class="line">/*</span><br><span class="line">WKNavigationDelegateå®ç°ï¼š</span><br><span class="line">é¦–æ¬¡è½½å…¥è°ƒç”¨é¡ºåºï¼šdidStartProvisionalNavigation -&gt; didCommitNavigation -&gt; didFinishNavigation</span><br><span class="line">é‡å®šå‘ï¼šdidStartProvisionalNavigation -&gt; didReceiveServerRedirectForProvisionalNavigation -&gt; didCommitNavigation -&gt; didFinishNavigation</span><br><span class="line">*/</span><br><span class="line">- (void)webView:(WKWebView *)webView didStartProvisionalNavigation:(null_unspecified WKNavigation *)navigation &#123;</span><br><span class="line">    NSLog(@&quot;--%s&quot;,__func__);</span><br><span class="line">    //é¡µé¢å¼€å§‹åŠ è½½æ—¶è°ƒç”¨</span><br><span class="line">&#125;</span><br><span class="line">- (void)webView:(WKWebView *)webView didCommitNavigation:(null_unspecified WKNavigation *)navigation &#123;</span><br><span class="line">    NSLog(@&quot;--%s&quot;,__func__);</span><br><span class="line">    //å½“å†…å®¹å¼€å§‹è¿”å›æ—¶è°ƒç”¨</span><br><span class="line">&#125;</span><br><span class="line">- (void)webView:(WKWebView *)webView didFinishNavigation:(null_unspecified WKNavigation *)navigation &#123;</span><br><span class="line">    NSLog(@&quot;--%s&quot;,__func__);</span><br><span class="line">    //é¡µé¢åŠ è½½å®Œæˆä¹‹åè°ƒç”¨</span><br><span class="line">&#125;</span><br><span class="line">- (void)webView:(WKWebView *)webView didReceiveServerRedirectForProvisionalNavigation:(null_unspecified WKNavigation *)navigation &#123;</span><br><span class="line">    NSLog(@&quot;--%s&quot;,__func__);</span><br><span class="line">    //æœåŠ¡å™¨é‡å®šå‘é¡µé¢æ—¶è°ƒç”¨,å¹¶ä¸”åœ¨ didStartProvisionalNavigation ä¹‹åï¼ŒdidCommitNavigationä¹‹å‰è°ƒç”¨ã€‚</span><br><span class="line">&#125;</span><br><span class="line">- (void)webView:(WKWebView *)webView didFailProvisionalNavigation:(null_unspecified WKNavigation *)navigation withError:(NSError *)error &#123;</span><br><span class="line">    NSLog(@&quot;--%s&quot;,__func__);</span><br><span class="line">    //é¡µé¢åŠ è½½å¤±è´¥æ—¶è°ƒç”¨</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Swiftç‰ˆæœ¬-1"><a href="#Swiftç‰ˆæœ¬-1" class="headerlink" title="Swiftç‰ˆæœ¬"></a>Swiftç‰ˆæœ¬</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> configuration = <span class="type">WKWebViewConfiguration</span>()</span><br><span class="line"><span class="keyword">let</span> webView = <span class="type">WKWebView</span>(frame: view.bounds, configuration: configuration)</span><br><span class="line">webView.navigationDelegate = <span class="keyword">self</span></span><br><span class="line">webView.uiDelegate = <span class="keyword">self</span></span><br><span class="line">view.addSubview(webView)</span><br><span class="line"><span class="keyword">let</span> url = <span class="type">URL</span>(string: <span class="string">"https://www.baidu.com"</span>)!</span><br><span class="line">webView.load(<span class="type">URLRequest</span>(url: url))</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//éœ€è¦éµå®ˆåè®® WKNavigationDelegate, WKUIDelegate</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">é¡ºåºï¼šdidStartProvisionalNavigation -&gt; didCommit -&gt; didFinish</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ViewController</span>: <span class="title">WKNavigationDelegate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(<span class="number">_</span> webView: WKWebView, didStartProvisionalNavigation navigation: WKNavigation!)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(#function)</span><br><span class="line">        <span class="comment">//é¡µé¢å¼€å§‹åŠ è½½æ—¶è°ƒç”¨</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(<span class="number">_</span> webView: WKWebView, didCommit navigation: WKNavigation!)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(#function)</span><br><span class="line">        <span class="comment">//å½“å†…å®¹å¼€å§‹è¿”å›æ—¶è°ƒç”¨</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(<span class="number">_</span> webView: WKWebView, didFinish navigation: WKNavigation!)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(#function)</span><br><span class="line">        <span class="comment">//é¡µé¢åŠ è½½å®Œæˆä¹‹åè°ƒç”¨</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(<span class="number">_</span> webView: WKWebView, didReceiveServerRedirectForProvisionalNavigation navigation: WKNavigation!)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(#function)</span><br><span class="line">        <span class="comment">//æœåŠ¡å™¨é‡å®šå‘é¡µé¢æ—¶è°ƒç”¨.</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(<span class="number">_</span> webView: WKWebView, didFailProvisionalNavigation navigation: WKNavigation!, withError error: Error)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(#function)</span><br><span class="line">        <span class="comment">//é¡µé¢åŠ è½½å¤±è´¥æ—¶è°ƒç”¨</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="iOSä¸­æ‰§è¡Œä¸€æ®µJavaScriptä»£ç "><a href="#iOSä¸­æ‰§è¡Œä¸€æ®µJavaScriptä»£ç " class="headerlink" title="iOSä¸­æ‰§è¡Œä¸€æ®µJavaScriptä»£ç "></a>iOSä¸­æ‰§è¡Œä¸€æ®µJavaScriptä»£ç </h1><p>åœ¨<code>iOS</code>ä¸­ä½¿ç”¨åŸç”Ÿè¯­è¨€å»æ‰§è¡Œ<code>JavaScript</code>è„šæœ¬ï¼Œæ˜¯ä¸ºäº†å¯¹å·²ç»åŠ è½½å¥½çš„<code>HTML</code>çš„<code>DOM</code>å…ƒç´ çš„å¢ã€åˆ ã€æ”¹ã€æŸ¥ã€‚åŒæ—¶ï¼Œè¿˜å¯ä»¥é€šè¿‡æ‰§è¡Œ<code>JavaScript</code>è„šæœ¬è·å–<code>DOM</code>å¯¹è±¡ï¼Œè¿›è€Œè·å–ä¸€äº›<code>HTML</code>çš„é¡µé¢ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼Œé€šè¿‡è„šæœ¬<code>document.title</code>å¯ä»¥è·å–å½“å‰é¡µé¢çš„<code>title</code>,é€šè¿‡è„šæœ¬<code>document.location.href</code>å¯ä»¥è·å–å½“å‰åŠ è½½çš„<code>HTML</code>é¡µé¢çš„<code>url</code>ã€‚<br>é€šå¸¸è¿™äº›æ“ä½œçš„æ–¹æ³•æ˜¯ï¼šä½¿ç”¨<code>UIWebView</code>æˆ–<code>WKWebView</code>çš„å¯¹è±¡æ–¹æ³•æ‰§è¡Œ<code>JavaScript</code>è„šæœ¬ã€‚é€šå¸¸è¿™äº›æ“ä½œçš„æ—¶æœºæ˜¯ï¼šåœ¨<code>HTML</code>é¡µé¢åŠ è½½å®Œæˆçš„åŸç”Ÿå›è°ƒä¸­è¿›è¡Œçš„ã€‚</p>
<h2 id="ä½¿ç”¨UIWebViewæ‰§è¡ŒJSä»£ç "><a href="#ä½¿ç”¨UIWebViewæ‰§è¡ŒJSä»£ç " class="headerlink" title="ä½¿ç”¨UIWebViewæ‰§è¡ŒJSä»£ç "></a>ä½¿ç”¨UIWebViewæ‰§è¡ŒJSä»£ç </h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--è¦åŠ è½½çš„HTMLæ–‡ä»¶ index.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=utf8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>è¿™æ˜¯ä¸€ä¸ªç½‘é¡µ<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="OCç‰ˆæœ¬-2"><a href="#OCç‰ˆæœ¬-2" class="headerlink" title="OCç‰ˆæœ¬"></a>OCç‰ˆæœ¬</h3><p>ä½¿ç”¨<code>UIWebView</code>çš„å¯¹è±¡æ–¹æ³•<code>- (nullable NSString *)stringByEvaluatingJavaScriptFromString:(NSString *)script;</code>æ¥æ‰§è¡Œä¸€æ®µ<code>JavaScript</code>ä»£ç ã€‚ä¸€èˆ¬æ˜¯åœ¨<code>UIWebView</code>çš„ä»£ç†æ–¹æ³•ï¼š<code>- (void)webViewDidFinishLoad:(UIWebView *)webView;</code>ä¸­ä½¿ç”¨ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">UIWebView *webView = [[UIWebView alloc] initWithFrame:self.view.bounds];</span><br><span class="line">webView.delegate = self;</span><br><span class="line">webView.scrollView.hidden = YES;</span><br><span class="line">webView.backgroundColor = [UIColor grayColor];</span><br><span class="line">webView.scalesPageToFit = YES;</span><br><span class="line">[self.view addSubview:webView];</span><br><span class="line">NSURL *htmlUrl = [[NSBundle mainBundle] URLForResource:@&quot;index&quot; withExtension:@&quot;html&quot;];</span><br><span class="line">NSURLRequest *request = [NSURLRequest requestWithURL:htmlUrl];</span><br><span class="line">[webView loadRequest:request];</span><br><span class="line"></span><br><span class="line">//æ·»åŠ ç½‘ç»œåŠ è½½æŒ‡ç¤ºå™¨</span><br><span class="line">UIActivityIndicatorView *indicatorView = [[UIActivityIndicatorView alloc] initWithActivityIndicatorStyle:UIActivityIndicatorViewStyleWhiteLarge];</span><br><span class="line">indicatorView.center = CGPointMake(200, 200);</span><br><span class="line">[self.view addSubview:indicatorView];</span><br><span class="line">self.indicatorView = indicatorView;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">// ä»£ç†</span><br><span class="line">- (void)webViewDidStartLoad:(UIWebView *)webView</span><br><span class="line">&#123;//ç½‘é¡µå¼€å§‹åŠ è½½æ—¶è°ƒç”¨</span><br><span class="line">    //æŒ‡ç¤ºå™¨å¼€å§‹æ˜¾ç¤ºåŠ¨ç”»</span><br><span class="line">    [self.indicatorView startAnimating];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)webViewDidFinishLoad:(UIWebView *)webView</span><br><span class="line">&#123;//ç½‘é¡µåŠ è½½å®Œæˆæ—¶è°ƒç”¨</span><br><span class="line">    </span><br><span class="line">    //æŒ‡ç¤ºå™¨ç»“æŸæ˜¾ç¤ºåŠ¨ç”»</span><br><span class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(0.25 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        webView.scrollView.hidden = NO;</span><br><span class="line">        [self.indicatorView stopAnimating];</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    //æ³¨æ„ï¼šJavaScriptè„šæœ¬å­—ç¬¦ä¸²ä¸­ä¸éœ€è¦æ·»åŠ &lt;script&gt;&lt;/script&gt;æ ‡ç­¾</span><br><span class="line">    NSString *jsStr_1 = @&quot;alert(&apos;JSå¼¹æ¡†&apos;)&quot;;</span><br><span class="line">    [webView stringByEvaluatingJavaScriptFromString:jsStr_1];</span><br><span class="line">    </span><br><span class="line">    NSString *jsStr_2 = @&quot;var p = document.getElementsByTagName(&apos;p&apos;)[0];&quot;;</span><br><span class="line">    NSString *jsStr_3 = @&quot;p.innerHTML = &apos;ä½¿ç”¨JavaScriptå¾ˆğŸ‚&apos;;&quot;;</span><br><span class="line">    NSString *jsStr_4 = @&quot;p.style.background = &apos;red&apos;;document.body.appendChild(p);&quot;;</span><br><span class="line">    [webView stringByEvaluatingJavaScriptFromString:jsStr_2];</span><br><span class="line">    [webView stringByEvaluatingJavaScriptFromString:jsStr_3];</span><br><span class="line">    [webView stringByEvaluatingJavaScriptFromString:jsStr_4];</span><br><span class="line">    </span><br><span class="line">    NSString *jsStr_5 = @&quot;var li = document.createElement(&apos;li&apos;);li.innerHTML=&apos;æ‰§è¡Œjsä»£ç ï¼Œdomæ“ä½œå…ƒç´ &apos;;li.style.background = &apos;gray&apos;;document.body.appendChild(li);&quot;;</span><br><span class="line">    [webView stringByEvaluatingJavaScriptFromString:jsStr_5];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Swiftç‰ˆæœ¬-2"><a href="#Swiftç‰ˆæœ¬-2" class="headerlink" title="Swiftç‰ˆæœ¬"></a>Swiftç‰ˆæœ¬</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//ç½‘ç»œåŠ è½½æŒ‡ç¤ºå™¨</span></span><br><span class="line">    <span class="built_in">lazy</span> <span class="keyword">var</span> indicatorView: <span class="type">UIActivityIndicatorView</span> = &#123;</span><br><span class="line">        <span class="keyword">var</span> indicator = <span class="type">UIActivityIndicatorView</span>(activityIndicatorStyle: .whiteLarge)</span><br><span class="line">        indicator.center = <span class="type">CGPoint</span>(x: <span class="number">200</span>, y: <span class="number">200</span>)</span><br><span class="line">        <span class="keyword">return</span> indicator</span><br><span class="line">    &#125;()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> webView = <span class="type">UIWebView</span>(frame: view.bounds)</span><br><span class="line">        webView.delegate = <span class="keyword">self</span></span><br><span class="line">        webView.scrollView.isHidden = <span class="literal">true</span></span><br><span class="line">        webView.backgroundColor = .gray</span><br><span class="line">        webView.scalesPageToFit = <span class="literal">true</span></span><br><span class="line">        view.addSubview(webView)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> url = <span class="type">Bundle</span>.main.url(forResource:<span class="string">"index"</span>, withExtension:<span class="string">"html"</span>)!</span><br><span class="line">        webView.loadRequest(<span class="type">URLRequest</span>(url: url))</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//æ·»åŠ ç½‘ç»œåŠ è½½æŒ‡ç¤ºå™¨</span></span><br><span class="line">        view.addSubview(indicatorView)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»£ç†</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ViewController</span>: <span class="title">UIWebViewDelegate</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">webViewDidStartLoad</span><span class="params">(<span class="number">_</span> webView: UIWebView)</span></span> &#123;<span class="comment">//ç½‘é¡µå¼€å§‹åŠ è½½æ—¶è°ƒç”¨</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//æŒ‡ç¤ºå™¨å¼€å§‹æ˜¾ç¤ºåŠ¨ç”»</span></span><br><span class="line">        indicatorView.startAnimating()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">webViewDidFinishLoad</span><span class="params">(<span class="number">_</span> webView: UIWebView)</span></span> &#123;<span class="comment">//ç½‘é¡µåŠ è½½å®Œæˆæ—¶è°ƒç”¨</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//æŒ‡ç¤ºå™¨ç»“æŸæ˜¾ç¤ºåŠ¨ç”»</span></span><br><span class="line">        <span class="type">DispatchQueue</span>.main.asyncAfter(deadline: <span class="type">DispatchTime</span>.now() + <span class="number">0.25</span>) &#123; </span><br><span class="line">            webView.scrollView.isHidden = <span class="literal">false</span></span><br><span class="line">            <span class="keyword">self</span>.indicatorView.stopAnimating()</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//æ³¨æ„ï¼šJavaScriptè„šæœ¬å­—ç¬¦ä¸²ä¸­ä¸éœ€è¦æ·»åŠ &lt;script&gt;&lt;/script&gt;æ ‡ç­¾</span></span><br><span class="line">        <span class="keyword">let</span> jsStr_1 = <span class="string">"alert('JSå¼¹æ¡†')"</span></span><br><span class="line">        webView.stringByEvaluatingJavaScript(from: jsStr_1)</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> jsStr_2 = <span class="string">"var p = document.getElementsByTagName('p')[0];"</span></span><br><span class="line">        <span class="keyword">let</span> jsStr_3 = <span class="string">"p.innerHTML = 'ä½¿ç”¨JavaScriptå¾ˆğŸ‚';"</span></span><br><span class="line">        <span class="keyword">let</span> jsStr_4 = <span class="string">"p.style.background = 'red';document.body.appendChild(p);"</span></span><br><span class="line">        webView.stringByEvaluatingJavaScript(from: jsStr_2)</span><br><span class="line">        webView.stringByEvaluatingJavaScript(from: jsStr_3)</span><br><span class="line">        webView.stringByEvaluatingJavaScript(from: jsStr_4)</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> jsStr_5 = <span class="string">"var li = document.createElement('li');li.innerHTML='æ‰§è¡Œjsä»£ç ï¼Œdomæ“ä½œå…ƒç´ ';li.style.background = 'gray';document.body.appendChild(li);"</span></span><br><span class="line">        webView.stringByEvaluatingJavaScript(from: jsStr_5)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ä½¿ç”¨WKWebViewæ‰§è¡ŒJSä»£ç "><a href="#ä½¿ç”¨WKWebViewæ‰§è¡ŒJSä»£ç " class="headerlink" title="ä½¿ç”¨WKWebViewæ‰§è¡ŒJSä»£ç "></a>ä½¿ç”¨WKWebViewæ‰§è¡ŒJSä»£ç </h2><h3 id="OCç‰ˆæœ¬-3"><a href="#OCç‰ˆæœ¬-3" class="headerlink" title="OCç‰ˆæœ¬"></a>OCç‰ˆæœ¬</h3><p>ä½¿ç”¨<code>WKWebView</code>çš„å¯¹è±¡æ–¹æ³•<code>- (void)evaluateJavaScript:(NSString *)javaScriptString completionHandler:(void (^ _Nullable)(_Nullable id, NSError * _Nullable error))completionHandler;</code>æ¥æ‰§è¡Œä¸€æ®µ<code>JavaScript</code>ä»£ç ã€‚ä¸€èˆ¬æ˜¯åœ¨<code>WKWebView</code>çš„ä»£ç†æ–¹æ³•ï¼š<code>- (void)webView:(WKWebView *)webView didFinishNavigation:(null_unspecified WKNavigation *)navigation;</code>ä¸­ä½¿ç”¨ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">WKWebViewConfiguration *configuration = [[WKWebViewConfiguration alloc] init];</span><br><span class="line"></span><br><span class="line">WKWebView *webView = [[WKWebView alloc] initWithFrame:self.view.bounds configuration:configuration];</span><br><span class="line">webView.UIDelegate = self;</span><br><span class="line">webView.navigationDelegate = self;</span><br><span class="line">webView.scrollView.hidden = YES;</span><br><span class="line">webView.backgroundColor = [UIColor grayColor];</span><br><span class="line">[self.view addSubview:webView];</span><br><span class="line">NSURL *url = [[NSBundle mainBundle] URLForResource:@&quot;index&quot; withExtension:@&quot;html&quot;];</span><br><span class="line">[webView loadRequest:[NSURLRequest requestWithURL:url]];</span><br><span class="line"></span><br><span class="line">//æ·»åŠ ç½‘ç»œåŠ è½½æŒ‡ç¤ºå™¨</span><br><span class="line">UIActivityIndicatorView *indicatorView = [[UIActivityIndicatorView alloc] initWithActivityIndicatorStyle:UIActivityIndicatorViewStyleWhiteLarge];</span><br><span class="line">indicatorView.center = CGPointMake(200, 200);</span><br><span class="line">[self.view addSubview:indicatorView];</span><br><span class="line">self.indicatorView = indicatorView;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">// ä»£ç† WKNavigationDelegate</span><br><span class="line">- (void)webView:(WKWebView *)webView didStartProvisionalNavigation:(null_unspecified WKNavigation *)navigation</span><br><span class="line">&#123;//é¡µé¢å¼€å§‹åŠ è½½æ—¶è°ƒç”¨</span><br><span class="line">    //æŒ‡ç¤ºå™¨å¼€å§‹æ˜¾ç¤ºåŠ¨ç”»</span><br><span class="line">    [self.indicatorView startAnimating];</span><br><span class="line">&#125;</span><br><span class="line">- (void)webView:(WKWebView *)webView didFinishNavigation:(null_unspecified WKNavigation *)navigation</span><br><span class="line">&#123; //é¡µé¢åŠ è½½å®Œæˆä¹‹åè°ƒç”¨</span><br><span class="line">    </span><br><span class="line">    //æŒ‡ç¤ºå™¨ç»“æŸæ˜¾ç¤ºåŠ¨ç”»</span><br><span class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(0.25 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        webView.scrollView.hidden = NO;</span><br><span class="line">        [self.indicatorView stopAnimating];</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    //æ³¨æ„ï¼šJavaScriptè„šæœ¬å­—ç¬¦ä¸²ä¸­ä¸éœ€è¦æ·»åŠ &lt;script&gt;&lt;/script&gt;æ ‡ç­¾</span><br><span class="line">    NSString *jsStr_1 = @&quot;var p = document.getElementsByTagName(&apos;p&apos;)[0];&quot;;</span><br><span class="line">    NSString *jsStr_2 = @&quot;p.innerHTML = &apos;ä½¿ç”¨JavaScriptå¾ˆğŸ‚&apos;;&quot;;</span><br><span class="line">    NSString *jsStr_3 = @&quot;p.style.background = &apos;red&apos;;document.body.appendChild(p);&quot;;</span><br><span class="line">    [webView evaluateJavaScript:jsStr_1 completionHandler:nil];</span><br><span class="line">    [webView evaluateJavaScript:jsStr_2 completionHandler:^(id _Nullable value, NSError * _Nullable error) &#123;</span><br><span class="line">        NSLog(@&quot;value: %@&quot;,value); //æ‰“å°å‡ºæ’å…¥çš„å†…å®¹ï¼šä½¿ç”¨JavaScriptå¾ˆğŸ‚</span><br><span class="line">    &#125;];</span><br><span class="line">    [webView evaluateJavaScript:jsStr_3 completionHandler:nil];</span><br><span class="line">    </span><br><span class="line">    NSString *jsStr_4 = @&quot;var li = document.createElement(&apos;li&apos;);li.innerHTML=&apos;æ‰§è¡Œjsä»£ç ï¼Œdomæ“ä½œå…ƒç´ &apos;;li.style.background = &apos;gray&apos;;document.body.appendChild(li);&quot;;</span><br><span class="line">    [webView evaluateJavaScript:jsStr_4 completionHandler:nil];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Swiftç‰ˆæœ¬-3"><a href="#Swiftç‰ˆæœ¬-3" class="headerlink" title="Swiftç‰ˆæœ¬"></a>Swiftç‰ˆæœ¬</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    <span class="comment">//ç½‘ç»œåŠ è½½æŒ‡ç¤ºå™¨</span></span><br><span class="line">    <span class="built_in">lazy</span> <span class="keyword">var</span> indicatorView: <span class="type">UIActivityIndicatorView</span> = &#123;</span><br><span class="line">        <span class="keyword">var</span> indicator = <span class="type">UIActivityIndicatorView</span>(activityIndicatorStyle: .whiteLarge)</span><br><span class="line">        indicator.center = <span class="type">CGPoint</span>(x: <span class="number">200</span>, y: <span class="number">200</span>)</span><br><span class="line">        <span class="keyword">return</span> indicator</span><br><span class="line">    &#125;()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> configuration = <span class="type">WKWebViewConfiguration</span>()</span><br><span class="line">        <span class="keyword">let</span> webView = <span class="type">WKWebView</span>(frame: view.bounds, configuration: configuration)</span><br><span class="line">        webView.scrollView.isHidden = <span class="literal">true</span></span><br><span class="line">        webView.backgroundColor = .gray</span><br><span class="line">        webView.navigationDelegate = <span class="keyword">self</span></span><br><span class="line">        webView.uiDelegate = <span class="keyword">self</span></span><br><span class="line">        view.addSubview(webView)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> url = <span class="type">Bundle</span>.main.url(forResource:<span class="string">"index"</span>, withExtension:<span class="string">"html"</span>)!</span><br><span class="line">        webView.load(<span class="type">URLRequest</span>(url: url))</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//æ·»åŠ ç½‘ç»œåŠ è½½æŒ‡ç¤ºå™¨</span></span><br><span class="line">        view.addSubview(indicatorView)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä»£ç† WKNavigationDelegate</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ViewController</span>: <span class="title">WKNavigationDelegate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(<span class="number">_</span> webView: WKWebView, didStartProvisionalNavigation navigation: WKNavigation!)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(#function) <span class="comment">//é¡µé¢å¼€å§‹åŠ è½½æ—¶è°ƒç”¨</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//æŒ‡ç¤ºå™¨å¼€å§‹æ˜¾ç¤ºåŠ¨ç”»</span></span><br><span class="line">        indicatorView.startAnimating()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(<span class="number">_</span> webView: WKWebView, didFinish navigation: WKNavigation!)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(#function) <span class="comment">//é¡µé¢åŠ è½½å®Œæˆä¹‹åè°ƒç”¨</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//æŒ‡ç¤ºå™¨ç»“æŸæ˜¾ç¤ºåŠ¨ç”»</span></span><br><span class="line">        <span class="type">DispatchQueue</span>.main.asyncAfter(deadline: <span class="type">DispatchTime</span>.now() + <span class="number">0.25</span>) &#123;</span><br><span class="line">            webView.scrollView.isHidden = <span class="literal">false</span></span><br><span class="line">            <span class="keyword">self</span>.indicatorView.stopAnimating()</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//æ³¨æ„ï¼šJavaScriptè„šæœ¬å­—ç¬¦ä¸²ä¸­ä¸éœ€è¦æ·»åŠ &lt;script&gt;&lt;/script&gt;æ ‡ç­¾</span></span><br><span class="line">        <span class="keyword">let</span> jsStr_1 = <span class="string">"var p = document.getElementsByTagName('p')[0];"</span></span><br><span class="line">        <span class="keyword">let</span> jsStr_2 = <span class="string">"p.innerHTML = 'ä½¿ç”¨JavaScriptå¾ˆğŸ‚';"</span></span><br><span class="line">        <span class="keyword">let</span> jsStr_3 = <span class="string">"p.style.background = 'red';document.body.appendChild(p);"</span></span><br><span class="line">        webView.evaluateJavaScript(jsStr_1, completionHandler: <span class="literal">nil</span>)</span><br><span class="line">        webView.evaluateJavaScript(jsStr_2) &#123; (value, error) <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">print</span>(value ?? <span class="string">""</span>) <span class="comment">//æ‰“å°å‡ºæ’å…¥çš„å†…å®¹ï¼šä½¿ç”¨JavaScriptå¾ˆğŸ‚</span></span><br><span class="line">        &#125;</span><br><span class="line">        webView.evaluateJavaScript(jsStr_3, completionHandler: <span class="literal">nil</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> jsStr_4 = <span class="string">"var li = document.createElement('li');li.innerHTML='æ‰§è¡Œjsä»£ç ï¼Œdomæ“ä½œå…ƒç´ ';li.style.background = 'gray';document.body.appendChild(li);"</span></span><br><span class="line">        webView.evaluateJavaScript(jsStr_4, completionHandler: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="iOSä¸­ç›‘å¬JavaScriptå‡½æ•°è°ƒç”¨"><a href="#iOSä¸­ç›‘å¬JavaScriptå‡½æ•°è°ƒç”¨" class="headerlink" title="iOSä¸­ç›‘å¬JavaScriptå‡½æ•°è°ƒç”¨"></a>iOSä¸­ç›‘å¬JavaScriptå‡½æ•°è°ƒç”¨</h1><p>åœ¨<code>iOS</code>æ··åˆ<code>HTML</code>å¼€å‘ä¸­ï¼Œå¦‚ä½•å»ç›‘å¬<code>HTML</code>é¡µé¢ä¸­ä¸€ä¸ª<code>JavaScript</code>å‡½æ•°çš„è°ƒç”¨ï¼Œè¿™æ˜¯åœ¨éœ€æ±‚ä¸­ç»å¸¸é‡åˆ°çš„ã€‚æ¯”å¦‚ï¼Œåœ¨ä¸€ä¸ªæ··åˆé¡µé¢ä¸­ï¼Œéœ€è¦ç‚¹å‡»<code>HTML</code>ä¸­çš„æŸä¸ªæŒ‰é’®æ ‡ç­¾ï¼Œè°ƒç”¨iPhoneç³»ç»Ÿç›¸æœºï¼Œè€Œç›¸æœºçš„è§¦å‘å¿…é¡»è°ƒç”¨<code>iOS</code>åŸç”Ÿæ–¹æ³•ã€‚å†æ¯”å¦‚ï¼Œåœ¨ä¸€ä¸ªæ··åˆé¡µé¢ä¸­ï¼Œéœ€è¦ç‚¹å‡»<code>HTML</code>ä¸­çš„æŸä¸ªæ”¯ä»˜æŒ‰é’®æ ‡ç­¾ï¼Œè°ƒç”¨iPhoneç³»ç»Ÿå·²ç»å®‰è£…çš„æ”¯ä»˜å®åº”ç”¨è¿›è¡Œæ”¯ä»˜æ“ä½œï¼Œæ¥å®ç°åº”ç”¨é—´çš„ä¼ å‚è·³è½¬ï¼Œå°±éœ€è¦è°ƒç”¨<code>æ”¯ä»˜å®SDK</code>çš„<code>iOS</code>åŸç”Ÿæ–¹æ³•ã€‚åˆæ¯”å¦‚ï¼Œåœ¨æ··åˆå¼€å‘ä¸­ï¼Œéœ€è¦ä»ä¸€ä¸ª<code>HTML</code>é¡µé¢è·³è½¬åˆ°æˆ‘çš„åŸç”Ÿé¡µé¢ï¼Œå¹¶ä¸”ä¼ é€ç›¸åº”çš„å‚æ•°ï¼Œå°±éœ€è¦ç›‘å¬<code>JavaScript</code>äº‹ä»¶ï¼Œè°ƒç”¨åŸç”Ÿæ§åˆ¶å™¨è·³è½¬æ–¹æ³•ã€‚è¿™åˆè¢«å¾ˆå¤šäººç§°ä¸ºç”¨<code>JavaScript</code>è°ƒç”¨<code>iOS</code>åŸç”Ÿä»£ç ï¼Œä¸ªäººè®¤ä¸ºè¿™ç§è¯´æ³•æ˜¯ä¸å‡†ç¡®çš„ã€‚ç¡®åˆ‡çš„è¯´ï¼Œ<code>iOS</code>ä¸­ç›‘å¬<code>JavaScript</code>å‡½æ•°è°ƒç”¨ï¼Œå¹¶ä½œå‡ºç›¸åº”çš„è¡Œä¸ºï¼Œæ¯”è¾ƒå‡†ç¡®ã€‚</p>
<h2 id="ä½¿ç”¨UIWebViewç›‘å¬JSå‡½æ•°è°ƒç”¨"><a href="#ä½¿ç”¨UIWebViewç›‘å¬JSå‡½æ•°è°ƒç”¨" class="headerlink" title="ä½¿ç”¨UIWebViewç›‘å¬JSå‡½æ•°è°ƒç”¨"></a>ä½¿ç”¨UIWebViewç›‘å¬JSå‡½æ•°è°ƒç”¨</h2><p>åœ¨<code>HTML</code>é¡µé¢ä¸­ï¼Œå¯¹è¦è§¦å‘çš„<code>JavaScript</code>æ–¹æ³•ä¸­ï¼Œä½¿ç”¨<code>window.location.href =</code>å®ç°ä¸€ä¸ªé¡µé¢é‡å®šå‘ã€‚å½“è§¦å‘é¡µé¢ä¸­<code>JavaScript</code>æ–¹æ³•ï¼Œå³ä¼šè°ƒç”¨<code>window.location.href =</code>è¿›è¡Œé¡µé¢é‡å®šå‘æ—¶ï¼Œæ­¤æ—¶<code>UIWebView</code>ä»£ç†æ–¹æ³•<code>- (BOOL)webView:(UIWebView *)webView shouldStartLoadWithRequest:(NSURLRequest *)request navigationType:(UIWebViewNavigationType)navigationType;</code>ä¼šç›‘å¬åˆ°é¡µé¢çš„é‡å®šå‘ï¼Œå¹¶ä¸”å¯ä»¥è·å–è¯·æ±‚å¯¹è±¡ï¼Œ<code>NSURLRequest</code>å¯¹è±¡<code>request</code>ï¼Œä»<code>request</code>ä¸­å¯ä»¥è·å¾—é‡å®šå‘çš„åœ°å€ã€‚å¯ä»¥å¯¹è¦é‡å®šå‘çš„åœ°å€è¿›è¡Œé‡æ–°å®šä¹‰åè®®ï¼Œä¾‹å¦‚ï¼Œ<code>&#39;mengyueping.com://&#39;</code>ï¼Œåé¢å¯ä»¥æ‹¼æ¥ä¸Šè¦è§¦å‘çš„<code>OC/Swift</code>æ–¹æ³•åï¼Œ<code>&#39;mengyueping.com://openCamera&#39;</code>ï¼Œåœ¨ä»£ç†ä¸­æ‹¦æˆªåˆ°å®Œæ•´åè®®åœ°å€ï¼Œå¯ä»¥é€šè¿‡æˆªå–è·å¾—<code>OC/Swift</code>æ–¹æ³•åï¼Œç„¶åæ ¹æ®æ–¹æ³•åç»™æ–¹æ³•å‘é€æ¶ˆæ¯ï¼Œè§¦å‘æ–¹æ³•ï¼Œä»è€Œè¾¾åˆ°ç›‘å¬<code>JavaScript</code>å‡½æ•°è°ƒç”¨çš„ç›®çš„ã€‚</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--åŠ è½½çš„æœ¬åœ°HTML--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"openCamera()"</span>&gt;</span>è®¿é—®ç›¸å†Œ<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"https://baidu.com"</span>&gt;</span>ç™¾åº¦<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"field"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">            function openCamera() &#123;</span></span><br><span class="line"><span class="undefined">                document.getElementById('field').value = "èµ‹å€¼ä¸€ä¸‹";</span></span><br><span class="line"><span class="undefined">                window.location.href = 'mengyueping.com://openCamera'; //è‡ªå®šä¹‰åè®®</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="OCç‰ˆæœ¬-4"><a href="#OCç‰ˆæœ¬-4" class="headerlink" title="OCç‰ˆæœ¬"></a>OCç‰ˆæœ¬</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">UIWebView *webView = [[UIWebView alloc] initWithFrame:self.view.bounds];</span><br><span class="line">webView.delegate = self;</span><br><span class="line">webView.backgroundColor = [UIColor grayColor];</span><br><span class="line">webView.scalesPageToFit = YES;</span><br><span class="line">[self.view addSubview:webView];</span><br><span class="line"></span><br><span class="line">NSURL *htmlUrl = [[NSBundle mainBundle] URLForResource:@&quot;index&quot; withExtension:@&quot;html&quot;];</span><br><span class="line">[webView loadRequest:[NSURLRequest requestWithURL:htmlUrl]];</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">//ä»£ç† UIWebViewDelegate</span><br><span class="line">- (BOOL)webView:(UIWebView *)webView shouldStartLoadWithRequest:(NSURLRequest *)request navigationType:(UIWebViewNavigationType)navigationType</span><br><span class="line">&#123;</span><br><span class="line">    NSString *url = request.URL.absoluteString;</span><br><span class="line">    NSRange range = [url rangeOfString:@&quot;mengyueping.com://&quot;]; //è‡ªå®šä¹‰åè®®</span><br><span class="line">    NSUInteger location = range.location;</span><br><span class="line">    </span><br><span class="line">    if (location != NSNotFound) &#123;</span><br><span class="line">        NSString *str = [url substringFromIndex:(location + range.length)];</span><br><span class="line">        SEL selector = NSSelectorFromString(str);</span><br><span class="line">        //è­¦å‘Šï¼šPerformSelector may cause a leak because its selector is unknown</span><br><span class="line">        //[self performSelector:selector];</span><br><span class="line">        [self performSelector:selector withObject:nil afterDelay:0.0];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return YES;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// iOSåŸç”Ÿæ–¹æ³•è®¿é—®ç›¸å†Œ</span><br><span class="line">- (void)openCamera</span><br><span class="line">&#123;</span><br><span class="line">    UIImagePickerController *picker = [[UIImagePickerController alloc] init];</span><br><span class="line">    picker.sourceType = UIImagePickerControllerSourceTypePhotoLibrary;</span><br><span class="line">    [self presentViewController:picker animated:YES completion:nil];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Swiftç‰ˆæœ¬-4"><a href="#Swiftç‰ˆæœ¬-4" class="headerlink" title="Swiftç‰ˆæœ¬"></a>Swiftç‰ˆæœ¬</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> webView = <span class="type">UIWebView</span>(frame: view.bounds)</span><br><span class="line">        webView.delegate = <span class="keyword">self</span></span><br><span class="line">        webView.backgroundColor = .gray</span><br><span class="line">        webView.scalesPageToFit = <span class="literal">true</span></span><br><span class="line">        view.addSubview(webView)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> url = <span class="type">Bundle</span>.main.url(forResource:<span class="string">"index"</span>, withExtension:<span class="string">"html"</span>)!</span><br><span class="line">        webView.loadRequest(<span class="type">URLRequest</span>(url: url))</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// iOSåŸç”Ÿæ–¹æ³•è®¿é—®ç›¸å†Œ</span></span><br><span class="line">    <span class="meta">@objc</span> <span class="keyword">fileprivate</span> <span class="function"><span class="keyword">func</span> <span class="title">openCamera</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> pickerVC = <span class="type">UIImagePickerController</span>()</span><br><span class="line">        pickerVC.sourceType = .photoLibrary</span><br><span class="line">        <span class="keyword">self</span>.present(pickerVC, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»£ç† UIWebViewDelegate</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ViewController</span>: <span class="title">UIWebViewDelegate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(<span class="number">_</span> webView: UIWebView, shouldStartLoadWith request: URLRequest, navigationType: UIWebViewNavigationType)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> url = request.url?.absoluteString</span><br><span class="line">        <span class="keyword">let</span> range = url?.range(of: <span class="string">"mengyueping.com://"</span>) <span class="comment">//è‡ªå®šä¹‰åè®®</span></span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> <span class="number">_</span> = range <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> str = url?.substring(from: <span class="string">"mengyueping.com://"</span>.endIndex)</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> selStr = str <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> selector = <span class="type">Selector</span>(selStr)</span><br><span class="line">        perform(selector)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ä½¿ç”¨WKWebViewç›‘å¬JSå‡½æ•°è°ƒç”¨"><a href="#ä½¿ç”¨WKWebViewç›‘å¬JSå‡½æ•°è°ƒç”¨" class="headerlink" title="ä½¿ç”¨WKWebViewç›‘å¬JSå‡½æ•°è°ƒç”¨"></a>ä½¿ç”¨WKWebViewç›‘å¬JSå‡½æ•°è°ƒç”¨</h2><h3 id="OCç‰ˆæœ¬-5"><a href="#OCç‰ˆæœ¬-5" class="headerlink" title="OCç‰ˆæœ¬"></a>OCç‰ˆæœ¬</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// appæ³¨å†Œæ–¹æ³•ï¼Œä¾›JSè°ƒç”¨</span><br><span class="line">WKWebViewConfiguration *configuration = [[WKWebViewConfiguration alloc] init];</span><br><span class="line"></span><br><span class="line">WKWebView *webView = [[WKWebView alloc] initWithFrame:self.view.bounds configuration:configuration];</span><br><span class="line">webView.UIDelegate = self;</span><br><span class="line">webView.navigationDelegate = self;</span><br><span class="line">webView.backgroundColor = [UIColor grayColor];</span><br><span class="line">[self.view addSubview:webView];</span><br><span class="line">NSURL *url = [[NSBundle mainBundle] URLForResource:@&quot;index&quot; withExtension:@&quot;html&quot;];</span><br><span class="line">[webView loadRequest:[NSURLRequest requestWithURL:url]];</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">// ä»£ç† WKNavigationDelegate</span><br><span class="line">- (void)webView:(WKWebView *)webView didReceiveServerRedirectForProvisionalNavigation:(null_unspecified WKNavigation *)navigation</span><br><span class="line">&#123; //é¡µé¢é‡å®šå‘æ—¶è°ƒç”¨ï¼Œä¸æ˜¯æ¯æ¬¡éƒ½è°ƒç”¨ï¼Œä¸å‡†ç¡®</span><br><span class="line">    NSLog(@&quot;navigation: %@&quot;,navigation);</span><br><span class="line">&#125;</span><br><span class="line">- (void)webView:(WKWebView *)webView decidePolicyForNavigationAction:(WKNavigationAction *)navigationAction decisionHandler:(void (^)(WKNavigationActionPolicy))decisionHandler</span><br><span class="line">&#123;//åœ¨å‘é€è¯·æ±‚ä¹‹å‰ï¼Œå†³å®šæ˜¯å¦è·³è½¬ï¼Œå¯ä»¥æˆªè·å‘é€çš„è¯·æ±‚</span><br><span class="line">    </span><br><span class="line">    NSString *url = navigationAction.request.URL.absoluteString;</span><br><span class="line">    NSRange range = [url rangeOfString:@&quot;mengyueping.com://&quot;]; //è‡ªå®šä¹‰åè®®</span><br><span class="line">    NSUInteger location = range.location;</span><br><span class="line">    </span><br><span class="line">    if (location != NSNotFound) &#123;</span><br><span class="line">        NSString *str = [url substringFromIndex:(location + range.length)];</span><br><span class="line">        SEL selector = NSSelectorFromString(str);</span><br><span class="line">        //è­¦å‘Šï¼šPerformSelector may cause a leak because its selector is unknown</span><br><span class="line">        //[self performSelector:selector];</span><br><span class="line">        [self performSelector:selector withObject:nil afterDelay:0.0];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    decisionHandler(WKNavigationActionPolicyAllow);</span><br><span class="line">&#125;</span><br><span class="line">- (void)webView:(WKWebView *)webView decidePolicyForNavigationResponse:(WKNavigationResponse *)navigationResponse decisionHandler:(void (^)(WKNavigationResponsePolicy))decisionHandler</span><br><span class="line">&#123;// åœ¨æ”¶åˆ°å“åº”åï¼Œå†³å®šæ˜¯å¦è·³è½¬ï¼Œå¯ä»¥æˆªè·æœåŠ¡å™¨çš„å“åº”æ•°æ®</span><br><span class="line">    decisionHandler(WKNavigationResponsePolicyAllow);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// iOSåŸç”Ÿæ–¹æ³•è®¿é—®ç›¸å†Œ</span><br><span class="line">- (void)openCamera</span><br><span class="line">&#123;</span><br><span class="line">    UIImagePickerController *picker = [[UIImagePickerController alloc] init];</span><br><span class="line">    picker.sourceType = UIImagePickerControllerSourceTypePhotoLibrary;</span><br><span class="line">    [self presentViewController:picker animated:YES completion:nil];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Swiftç‰ˆæœ¬-5"><a href="#Swiftç‰ˆæœ¬-5" class="headerlink" title="Swiftç‰ˆæœ¬"></a>Swiftç‰ˆæœ¬</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> configuration = <span class="type">WKWebViewConfiguration</span>()</span><br><span class="line">        <span class="keyword">let</span> webView = <span class="type">WKWebView</span>(frame: view.bounds, configuration: configuration)</span><br><span class="line">        webView.backgroundColor = .gray</span><br><span class="line">        webView.navigationDelegate = <span class="keyword">self</span></span><br><span class="line">        webView.uiDelegate = <span class="keyword">self</span></span><br><span class="line">        view.addSubview(webView)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> url = <span class="type">Bundle</span>.main.url(forResource:<span class="string">"index"</span>, withExtension:<span class="string">"html"</span>)!</span><br><span class="line">        webView.load(<span class="type">URLRequest</span>(url: url))</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// iOSåŸç”Ÿæ–¹æ³•è®¿é—®ç›¸å†Œ</span></span><br><span class="line">    <span class="meta">@objc</span> <span class="keyword">fileprivate</span> <span class="function"><span class="keyword">func</span> <span class="title">openCamera</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> pickerVC = <span class="type">UIImagePickerController</span>()</span><br><span class="line">        pickerVC.sourceType = .photoLibrary</span><br><span class="line">        <span class="keyword">self</span>.present(pickerVC, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»£ç† WKNavigationDelegate</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ViewController</span>: <span class="title">WKNavigationDelegate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(<span class="number">_</span> webView: WKWebView, didReceiveServerRedirectForProvisionalNavigation navigation: WKNavigation!)</span></span> &#123; </span><br><span class="line">        <span class="comment">//é¡µé¢é‡å®šå‘æ—¶è°ƒç”¨ï¼Œä¸æ˜¯æ¯æ¬¡éƒ½è°ƒç”¨ï¼Œä¸å‡†ç¡®</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(<span class="number">_</span> webView: WKWebView, decidePolicyFor navigationAction: WKNavigationAction, decisionHandler: @escaping <span class="params">(WKNavigationActionPolicy)</span></span></span> -&gt; <span class="type">Void</span>) &#123; </span><br><span class="line">        <span class="comment">// åœ¨å‘é€è¯·æ±‚ä¹‹å‰ï¼Œå†³å®šæ˜¯å¦è·³è½¬ï¼Œå¯ä»¥æˆªè·å‘é€çš„è¯·æ±‚</span></span><br><span class="line">        decisionHandler(.allow)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> url = navigationAction.request.url?.absoluteString</span><br><span class="line">        <span class="keyword">let</span> range = url?.range(of: <span class="string">"mengyueping.com://"</span>) <span class="comment">//è‡ªå®šä¹‰åè®®</span></span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> <span class="number">_</span> = range <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> str = url?.substring(from: <span class="string">"mengyueping.com://"</span>.endIndex)</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> selStr = str <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> selector = <span class="type">Selector</span>(selStr)</span><br><span class="line">        perform(selector)</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(<span class="number">_</span> webView: WKWebView, decidePolicyFor navigationResponse: WKNavigationResponse, decisionHandler: @escaping <span class="params">(WKNavigationResponsePolicy)</span></span></span> -&gt; <span class="type">Void</span>) &#123; </span><br><span class="line">        <span class="comment">// åœ¨æ”¶åˆ°å“åº”åï¼Œå†³å®šæ˜¯å¦è·³è½¬ï¼Œå¯ä»¥æˆªè·æœåŠ¡å™¨çš„å“åº”æ•°æ®</span></span><br><span class="line">        decisionHandler(.allow)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(<span class="number">_</span> webView: WKWebView, didStartProvisionalNavigation navigation: WKNavigation!)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(#function) <span class="comment">//é¡µé¢å¼€å§‹åŠ è½½æ—¶è°ƒç”¨</span></span><br><span class="line">        <span class="comment">// ä¸æ˜¯æ¯æ¬¡éƒ½è°ƒç”¨ï¼Œåªæœ‰decisionHandler(.allow)æ—¶æ‰èƒ½è°ƒç”¨æ­¤æ–¹æ³•</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="WKWebViewä¸JSä¹‹é—´çš„é€šä¿¡"><a href="#WKWebViewä¸JSä¹‹é—´çš„é€šä¿¡" class="headerlink" title="WKWebViewä¸JSä¹‹é—´çš„é€šä¿¡"></a>WKWebViewä¸JSä¹‹é—´çš„é€šä¿¡</h2><p><code>iOS</code>çš„<code>WebKit</code>ä¸­ï¼Œä¸º<code>JavaScript</code>æä¾›äº†ä¸€ä¸ªå‘æ¶ˆæ¯çš„é€šé“ï¼Œæ˜¯é€šè¿‡<code>WKUserContentController</code>ç±»å®ç°çš„ï¼Œå¯ä»¥é€šè¿‡é…ç½®ç±»<code>WKWebViewConfiguration</code>é…ç½®åˆ°<code>WKWebView</code>å¯¹è±¡ä¸Šã€‚å¹¶ä¸”<code>WKUserContentController</code>çš„å¯¹è±¡å¯ä»¥æ·»åŠ ä¸€ä¸ªè„šæœ¬ä¿¡æ¯å¤„ç†å™¨ï¼Œ(<code>addScriptMessageHandler: name:</code> æˆ– <code>add(_ scriptMessageHandler: WKScriptMessageHandler, name: String)</code>)ï¼Œé€šè¿‡å®ç°åè®®<code>WKScriptMessageHandler</code>æ¥æ¥æ”¶å¤„ç†<code>JS</code>è„šæœ¬å‘é€è¿‡æ¥ä¿¡æ¯ã€‚</p>
<blockquote>
<p><code>WKWebViewConfiguration</code>ï¼šæ˜¯<code>WKWebView</code>åˆå§‹åŒ–æ—¶çš„é…ç½®ç±»ï¼Œé‡Œé¢å­˜å‚¨ç€åˆå§‹åŒ–<code>WKWebView</code>çš„ä¸€ç³»åˆ—å±æ€§ã€‚<br><code>WKUserContentController</code>ï¼šä¸º<code>JavaScript</code>æä¾›äº†ä¸€ä¸ªå‘é€æ¶ˆæ¯çš„é€šé“ï¼Œå¹¶ä¸”å¯ä»¥å‘é¡µé¢æ³¨å…¥<code>JavaScript</code>çš„ç±»ã€‚å¯ä»¥åœ¨é…ç½®ç±»&gt; <code>WKWebViewConfiguration</code>å±æ€§ä¸­ï¼Œé…ç½®æ­¤ç±»ã€‚<br><code>WKScriptMessageHandler</code>ï¼šä¸€ä¸ªåè®®ï¼Œåè®®åªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œé¡µé¢æ‰§è¡Œç‰¹å®š<code>JavaScript</code>çš„ä¸€ä¸ªå›è°ƒï¼Œè¿™ä¸ªç‰¹å®š<code>JavaScript</code>æ ¼å¼ä¸º<code>window.webkit.messageHandlers.&lt;name&gt;.postMessage(&lt;messageBody&gt;);</code></p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html è¦åŠ è½½çš„HTMLï¼ŒåŠé€šä¿¡è„šæœ¬ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"sendMsgToiOS()"</span>&gt;</span>ç‚¹å‡»ç»™iOSåŸç”Ÿå‘é€æ¶ˆæ¯<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"https://baidu.com"</span>&gt;</span>ç™¾åº¦<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    function sendMsgToiOS() &#123;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        var ua = navigator.userAgent.toLowerCase();</span></span><br><span class="line"><span class="undefined">        if (!!ua.match(/\(i[^;]+;( u;)? cpu.+mac os x/)) &#123; // iOS   Mac OS</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">            var JSCallIOS = function () &#123;</span></span><br><span class="line"><span class="undefined">                //å‘é€ç»™ iOS åŸç”Ÿçš„ json æ•°æ®</span></span><br><span class="line"><span class="undefined">                var message = &#123;</span></span><br><span class="line"><span class="undefined">                    'method': 'push', </span></span><br><span class="line"><span class="undefined">                    'name' : 'ç‹å°é”Œ',</span></span><br><span class="line"><span class="undefined">                    'title' : 'æœ‹å‹åœˆ',  </span></span><br><span class="line"><span class="undefined">                    'url': 'http://www.baidu.com'</span></span><br><span class="line"><span class="undefined">                &#125;;</span></span><br><span class="line"><span class="undefined">                //JS è„šæœ¬å‘ iOSåŸç”Ÿä¼ é€’æ¶ˆæ¯</span></span><br><span class="line"><span class="undefined">                window.webkit.messageHandlers.JSMessageToIOS.postMessage(message);</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">            JSCallIOS();</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        &#125; else if (/android/.test(ua)) &#123; // å®‰å“</span></span><br><span class="line"><span class="undefined">            window.android.finish();</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="OCç‰ˆæœ¬-6"><a href="#OCç‰ˆæœ¬-6" class="headerlink" title="OCç‰ˆæœ¬"></a>OCç‰ˆæœ¬</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// ä¸ºJSæä¾›äº†ä¸€ä¸ªå‘é€æ¶ˆæ¯çš„é€šé“ï¼Œä¸”å¯ä»¥å‘é¡µé¢æ³¨å…¥JSçš„ç±»ã€‚</span><br><span class="line">WKUserContentController *userContentController = [[WKUserContentController alloc] init];</span><br><span class="line">[userContentController addScriptMessageHandler:self name:@&quot;JSMessageToIOS&quot;]; // &lt;WKScriptMessageHandler&gt;</span><br><span class="line"></span><br><span class="line">// æ·»åŠ ä¸€ä¸ªè„šæœ¬ä¿¡æ¯å¤„ç†å™¨ã€‚selféµå®ˆåè®®WKScriptMessageHandler</span><br><span class="line">// è„šæœ¬ä¿¡æ¯å¤„ç†å™¨ï¼Œå¯ä»¥æ¥æ”¶JSè„šæœ¬å‘é€è¿‡æ¥çš„æ¶ˆæ¯ã€‚JSè„šæœ¬é€šè¿‡`window.webkit.messageHandlers.&lt;name&gt;.postMessage(&lt;messageBody&gt;)`å‘é€æ¶ˆæ¯ã€‚</span><br><span class="line">// è„šæœ¬å¤„ç†å™¨ä¸­ç›‘å¬çš„åå­—æ˜¯jsè„šæœ¬é‡Œé¢æ¶ˆæ¯å‘é€çš„åå­—ã€‚                 window.webkit.messageHandlers.JSMessageToIOS.postMessage(message);</span><br><span class="line"></span><br><span class="line">// é…ç½®</span><br><span class="line">WKWebViewConfiguration *configuration = [[WKWebViewConfiguration alloc] init];</span><br><span class="line">configuration.userContentController = userContentController; //é…ç½®æ¶ˆæ¯é€šé“</span><br><span class="line"></span><br><span class="line">WKWebView *webView = [[WKWebView alloc] initWithFrame:self.view.bounds configuration:configuration];</span><br><span class="line">webView.UIDelegate = self;  //&lt;WKUIDelegate&gt;</span><br><span class="line">webView.navigationDelegate = self; //&lt;WKNavigationDelegate&gt;</span><br><span class="line">webView.backgroundColor = [UIColor grayColor];</span><br><span class="line">[self.view addSubview:webView];</span><br><span class="line">NSURL *url = [[NSBundle mainBundle] URLForResource:@&quot;index&quot; withExtension:@&quot;html&quot;];</span><br><span class="line">[webView loadRequest:[NSURLRequest requestWithURL:url]];</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - åè®® WKScriptMessageHandler</span><br><span class="line">// å½“JSç»™OCå‘é€æ¶ˆæ¯æ—¶ï¼Œæ­¤å›è°ƒä¸­æ‰§è¡Œæ¶ˆæ¯å¤„ç†</span><br><span class="line">- (void)userContentController:(WKUserContentController *)userContentController didReceiveScriptMessage:(WKScriptMessage *)message</span><br><span class="line">&#123;</span><br><span class="line">    NSLog(@&quot;JSä¼ é€’è¿‡æ¥çš„æ¶ˆæ¯-message.body: %@&quot;,message.body);</span><br><span class="line">    </span><br><span class="line">    //æ”¶åˆ°JSä¼ é€’è¿‡æ¥çš„æ¶ˆæ¯å›è°ƒï¼Œå¯ä»¥åšä¸€äº›åŸç”Ÿæƒ³è¦åšçš„äº‹æƒ…ã€‚--&gt; JSå‘åŸç”ŸOCä¼ é€’æ¶ˆæ¯ã€‚</span><br><span class="line">    //å‘é€ç½‘ç»œè¯·æ±‚ï¼Œé¡µé¢è·³è½¬ï¼Œæ‰“å¼€ç›¸æœºç­‰</span><br><span class="line"></span><br><span class="line">    [self openCamera];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// iOSåŸç”Ÿæ–¹æ³•è®¿é—®ç›¸å†Œ</span><br><span class="line">- (void)openCamera</span><br><span class="line">&#123;</span><br><span class="line">    UIImagePickerController *picker = [[UIImagePickerController alloc] init];</span><br><span class="line">    picker.sourceType = UIImagePickerControllerSourceTypePhotoLibrary;</span><br><span class="line">    [self presentViewController:picker animated:YES completion:nil];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Swiftç‰ˆæœ¬-6"><a href="#Swiftç‰ˆæœ¬-6" class="headerlink" title="Swiftç‰ˆæœ¬"></a>Swiftç‰ˆæœ¬</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸ºJSæä¾›äº†ä¸€ä¸ªå‘é€æ¶ˆæ¯çš„é€šé“ï¼Œä¸”å¯ä»¥å‘é¡µé¢æ³¨å…¥JSçš„ç±»ã€‚</span></span><br><span class="line"><span class="keyword">let</span> userContentController = <span class="type">WKUserContentController</span>()</span><br><span class="line">userContentController.add(<span class="keyword">self</span>, name: <span class="string">"JSMessageToIOS"</span>)</span><br><span class="line"><span class="comment">// æ·»åŠ ä¸€ä¸ªè„šæœ¬ä¿¡æ¯å¤„ç†å™¨ã€‚selféµå®ˆåè®®WKScriptMessageHandler</span></span><br><span class="line"><span class="comment">// è„šæœ¬ä¿¡æ¯å¤„ç†å™¨ï¼Œå¯ä»¥æ¥æ”¶JSè„šæœ¬å‘é€è¿‡æ¥çš„æ¶ˆæ¯ã€‚JSè„šæœ¬é€šè¿‡`window.webkit.messageHandlers.&lt;name&gt;.postMessage(&lt;messageBody&gt;)`å‘é€æ¶ˆæ¯ã€‚</span></span><br><span class="line"><span class="comment">// è„šæœ¬å¤„ç†å™¨ä¸­ç›‘å¬çš„åå­—æ˜¯jsè„šæœ¬é‡Œé¢æ¶ˆæ¯å‘é€çš„åå­—ã€‚          window.webkit.messageHandlers.JSMessageToIOS.postMessage(message);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// é…ç½®</span></span><br><span class="line"><span class="keyword">let</span> configuration = <span class="type">WKWebViewConfiguration</span>()</span><br><span class="line">configuration.userContentController = userContentController</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> webView = <span class="type">WKWebView</span>(frame: view.bounds, configuration: configuration)</span><br><span class="line">webView.backgroundColor = .gray</span><br><span class="line">webView.navigationDelegate = <span class="keyword">self</span></span><br><span class="line">webView.uiDelegate = <span class="keyword">self</span></span><br><span class="line">view.addSubview(webView)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> url = <span class="type">Bundle</span>.main.url(forResource:<span class="string">"index"</span>, withExtension:<span class="string">"html"</span>)!</span><br><span class="line">webView.load(<span class="type">URLRequest</span>(url: url))</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ViewController</span>: <span class="title">WKScriptMessageHandler</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">userContentController</span><span class="params">(<span class="number">_</span> userContentController: WKUserContentController, didReceive message: WKScriptMessage)</span></span> &#123;</span><br><span class="line">        <span class="comment">// å½“JSç»™OCå‘é€æ¶ˆæ¯æ—¶ï¼Œæ­¤å›è°ƒä¸­æ‰§è¡Œæ¶ˆæ¯å¤„ç†</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"JSä¼ é€’è¿‡æ¥çš„æ¶ˆæ¯-message.body:<span class="subst">\(message.body)</span>, nameï¼š<span class="subst">\(message.name)</span>"</span>);</span><br><span class="line">        <span class="comment">//iOSå’Œjsç»Ÿä¸€å¥½çš„åå­—ï¼šmessage.name</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//æ”¶åˆ°JSä¼ é€’è¿‡æ¥çš„æ¶ˆæ¯å›è°ƒï¼Œå¯ä»¥åšä¸€äº›åŸç”Ÿæƒ³è¦åšçš„äº‹æƒ…ã€‚--&gt; JSå‘åŸç”ŸOCä¼ é€’æ¶ˆæ¯ã€‚</span></span><br><span class="line">        <span class="comment">//å‘é€ç½‘ç»œè¯·æ±‚ï¼Œé¡µé¢è·³è½¬ï¼Œæ‰“å¼€ç›¸æœºç­‰</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> vc = <span class="type">UIViewController</span>()</span><br><span class="line">        vc.title = <span class="string">"nameï¼š<span class="subst">\(message.name)</span>"</span></span><br><span class="line">        vc.view = &#123;</span><br><span class="line">            <span class="keyword">let</span> v = <span class="type">UITextView</span>(frame: <span class="keyword">self</span>.view.bounds)</span><br><span class="line">            v.text = <span class="string">"body: <span class="subst">\(message.body)</span>"</span></span><br><span class="line">            <span class="keyword">return</span> v</span><br><span class="line">        &#125;()</span><br><span class="line">        <span class="keyword">let</span> nav = <span class="type">UINavigationController</span>(rootViewController: vc)</span><br><span class="line">        <span class="keyword">self</span>.present(nav, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="iOSä¸­åˆ©ç”¨JavaScriptCoreäº¤äº’JS"><a href="#iOSä¸­åˆ©ç”¨JavaScriptCoreäº¤äº’JS" class="headerlink" title="iOSä¸­åˆ©ç”¨JavaScriptCoreäº¤äº’JS"></a>iOSä¸­åˆ©ç”¨JavaScriptCoreäº¤äº’JS</h1><p><code>JavaScriptCore.framework</code>æ˜¯<code>iOS7</code>ä»¥åæ¨å‡ºçš„ä¸€ä¸ª<code>JS</code>ä¸<code>OC</code>äº¤äº’çš„æ¡†æ¶ï¼Œæ˜¯ä½¿ç”¨<code>OC</code>è¯­è¨€å¯¹<code>WebKit</code>çš„<code>JS</code>å¼•æ“è¿›è¡Œçš„å°è£…ã€‚ä¹‹åå¼•å…¥<code>Swift</code>ã€‚<br>ä½¿ç”¨æ—¶å¯¼å…¥å¤´æ–‡ä»¶<code>#import &lt;JavaScriptCore/JavaScriptCore.h&gt;</code>æˆ–<code>import JavaScriptCore</code>ã€‚ç›¸å…³ç±»ï¼š<code>JSContext</code>ã€<code>JSValue</code>ã€<code>JSManagedValue</code>ã€<code>JSVirtualMachine</code>ã€<code>JSExport</code>ã€‚</p>
<h2 id="ä½¿ç”¨JSContextè¿è¡ŒJSä»£ç "><a href="#ä½¿ç”¨JSContextè¿è¡ŒJSä»£ç " class="headerlink" title="ä½¿ç”¨JSContextè¿è¡ŒJSä»£ç "></a>ä½¿ç”¨JSContextè¿è¡ŒJSä»£ç </h2><p><code>JSContext</code>æ˜¯è¿è¡Œ<code>JS</code>ä»£ç çš„ç¯å¢ƒï¼Œä¸€ä¸ª<code>JSContext</code>æ˜¯ä¸€ä¸ªå…¨å±€ç¯å¢ƒçš„å®ä¾‹ã€‚<code>JSContext</code>ç±»ä¼¼<code>window</code>å¯¹è±¡ã€‚é€šè¿‡å¯¹è±¡æ–¹æ³•<code>- (JSValue *)evaluateScript:(NSString *)script;</code>æ¥è¿è¡Œ<code>JS</code>ä»£ç ã€‚</p>
<p><code>JSValue</code>åŒ…å«äº†æ¯ä¸€ä¸ª<code>JS</code>ç±»å‹çš„å€¼ã€‚é€šè¿‡<code>JSValue</code>å¯ä»¥å°†<code>OC</code>ä¸­çš„ç±»å‹è½¬æ¢ä¸º<code>JS</code>ä¸­çš„ç±»å‹ï¼Œä¹Ÿå¯å°†<code>JS</code>ä¸­çš„ç±»å‹è½¬ä¸º<code>OC</code>ä¸­çš„ç±»å‹ã€‚ç±»å‹å¯¹ç…§å¦‚ä¸‹ï¼š</p>
<p><pre><br>    OC Swift type         |   JavaScript type<br>+++++++++++++++++++++++++++++++++++++++++++++++++++++++<br>         nil              |     undefined<br>        NSNull            |        null<br>  NSString String         |       string<br>       NSNumber           |   number, boolean<br>NSDictionary Dictionary   |   Object object<br>  NSArray  Array          |    Array object<br>        NSDate            |     Date object<br>       NSBlock (1)        |   Function object (1)<br>          id (2)          |   Wrapper object (2)<br>        Class (3)         | Constructor object (3)<br></pre><br><code>JSValue</code>éƒ½æ˜¯é€šè¿‡<code>JSContext</code>è¿”å›æˆ–è€…åˆ›å»ºçš„ï¼Œå¹¶æ²¡æœ‰æ„é€ æ–¹æ³•ã€‚æ¯ä¸€ä¸ª<code>JSValue</code>å¯¹è±¡éƒ½è¦å¼ºå¼•ç”¨å…³è”ä¸€ä¸ª<code>JSContext</code>ã€‚å½“ä¸<code>JSContext</code>å¯¹è±¡å…³è”çš„æ‰€æœ‰<code>JSValue</code>é‡Šæ”¾åï¼Œ<code>JSContext</code>ä¹Ÿä¼šé‡Šæ”¾ã€‚æˆ‘ä»¬å¯¹<code>JS</code>çš„æ•°å€¼ã€å¯¹è±¡ã€å‡½æ•°ç­‰è¿›è¡Œæ“ä½œï¼Œéƒ½æ˜¯é€šè¿‡<code>JSValue</code>å¯¹è±¡æ¥å®ç°çš„ã€‚<code>JSValue</code>æ˜¯ <code>JS</code> å’Œ <code>OC/Swift</code>æ•°æ®å’Œæ–¹æ³•çš„æ¡¥æ¢,å°è£…äº†<code>JS</code>ä¸<code>OC/Swift</code>ä¸­çš„å¯¹åº”çš„ç±»å‹ï¼Œä»¥åŠå¦‚ä½•é€šè¿‡<code>OC/Swift</code>æ–¹æ³•è°ƒç”¨<code>JS</code>å‡½æ•°çš„<code>API</code>ç­‰</p>
<h3 id="åˆå§‹åŒ–JSContextå¯¹è±¡åŠå¼‚å¸¸å¤„ç†"><a href="#åˆå§‹åŒ–JSContextå¯¹è±¡åŠå¼‚å¸¸å¤„ç†" class="headerlink" title="åˆå§‹åŒ–JSContextå¯¹è±¡åŠå¼‚å¸¸å¤„ç†"></a>åˆå§‹åŒ–JSContextå¯¹è±¡åŠå¼‚å¸¸å¤„ç†</h3><p><code>OC/Swift</code>å¼‚å¸¸ä¼šåœ¨è¿è¡Œæ—¶è¢«<code>Xcode</code>æ•è·ï¼Œ<code>JSContext</code>ä¸­æ‰§è¡Œçš„<code>JS</code>å¦‚æœå‡ºç°å¼‚å¸¸ï¼Œåªä¼šè¢«<code>JSContext</code>æ•è·å¹¶å­˜å‚¨åœ¨<code>exception</code>å±æ€§ä¸Šï¼Œè€Œä¸ä¼šå‘å¤–æŠ›å‡ºã€‚æ—¶åˆ»æ£€æŸ¥<code>JSContext</code>å¯¹è±¡çš„<code>exception</code>æ˜¯å¦ä¸º<code>nil</code>æ˜¾ç„¶æ˜¯ä¸åˆé€‚çš„ï¼Œæ›´åˆç†çš„æ–¹æ³•æ˜¯ï¼Œç»™<code>JSContext</code>å¯¹è±¡è®¾ç½®<code>exceptionHandler</code>å›è°ƒå±æ€§ï¼Œå®ƒæ¥å—çš„æ˜¯<code>void(^exceptionHandler)(JSContext *context, JSValue *exceptionValue)</code>å½¢å¼çš„<code>block</code>ï¼Œæˆ–<code>((JSContext?, JSValue?) -&gt; Swift.Void)</code>å½¢å¼çš„é—­åŒ…ã€‚å…¶é»˜è®¤å€¼å°±æ˜¯å°†ä¼ å…¥çš„<code>exceptionValue</code>èµ‹ç»™ä¼ å…¥çš„<code>context</code>çš„<code>exception</code>å±æ€§ã€‚è¿™æ ·<code>JS</code>è¿è¡Œå‘ç”Ÿå¼‚å¸¸çš„æ—¶å€™ï¼Œåœ¨<code>Block/Closure</code>ä¸­å¯ä»¥ç«‹å³çŸ¥é“ï¼Œé€šè¿‡è®¾ç½®<code>Block/Closure</code>ä¸­å‚æ•°<code>context.exception</code>å±æ€§ï¼Œå¯ä»¥è§‚å¯Ÿå’Œè®°å½•è¯­æ³•ã€ç±»å‹ä»¥åŠè¿è¡Œæ—¶é”™è¯¯ã€‚</p>
<h4 id="OCç‰ˆæœ¬-7"><a href="#OCç‰ˆæœ¬-7" class="headerlink" title="OCç‰ˆæœ¬"></a>OCç‰ˆæœ¬</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">JSContext *context = [[JSContext alloc] init];</span><br><span class="line">// å¼‚å¸¸å¤„ç†å›è°ƒ</span><br><span class="line">context.exceptionHandler = ^(JSContext *context, JSValue *exception) &#123;</span><br><span class="line">    NSLog(@&quot;%@&quot;, exception);</span><br><span class="line">    context.exception = exception;</span><br><span class="line">    /*</span><br><span class="line">        æ­¤å¤„æ‰“å°jså¼‚å¸¸é”™è¯¯ï¼ŒJSContextä¸ä¼šä¸»åŠ¨æŠ›å‡ºjså¼‚å¸¸ã€‚</span><br><span class="line">        å¸¸è§å¼‚å¸¸ï¼š</span><br><span class="line">            ReferenceError: Can&apos;t find variable:</span><br><span class="line">            TypeError: undefined is not an object</span><br><span class="line">    */</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="Swiftç‰ˆæœ¬-7"><a href="#Swiftç‰ˆæœ¬-7" class="headerlink" title="Swiftç‰ˆæœ¬"></a>Swiftç‰ˆæœ¬</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MARK: åˆå§‹åŒ–JSContextå¯¹è±¡åŠå¼‚å¸¸å¤„ç†</span></span><br><span class="line"><span class="built_in">lazy</span> <span class="keyword">var</span> context = <span class="type">JSContext</span>()!</span><br><span class="line">context.exceptionHandler = &#123; (context, exception) <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> excep = exception <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">print</span>(excep)</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    æ­¤å¤„æ‰“å°jså¼‚å¸¸é”™è¯¯ï¼ŒJSContextä¸ä¼šä¸»åŠ¨æŠ›å‡ºjså¼‚å¸¸ã€‚</span></span><br><span class="line"><span class="comment">    å¸¸è§å¼‚å¸¸ï¼š</span></span><br><span class="line"><span class="comment">        ReferenceError: Can't find variable:</span></span><br><span class="line"><span class="comment">        TypeError: undefined is not an object</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    context?.exception = excep</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ‰§è¡Œå¸¦è¿”å›ç»“æœjsè„šæœ¬"><a href="#æ‰§è¡Œå¸¦è¿”å›ç»“æœjsè„šæœ¬" class="headerlink" title="æ‰§è¡Œå¸¦è¿”å›ç»“æœjsè„šæœ¬"></a>æ‰§è¡Œå¸¦è¿”å›ç»“æœjsè„šæœ¬</h3><p>å¦‚æœæ‰§è¡Œçš„<code>js</code>è„šæœ¬æœ‰è¿”å›ç»“æœï¼Œåˆ™<code>- (JSValue *)evaluateScript:(NSString *)script;</code>æ‰§è¡Œåè¿”å›çš„<code>JSValue</code>å¯¹è±¡ï¼ŒåŒ…å«è¿”å›çš„ç»“æœã€‚å¯ä»¥è§£æä¸º<code>JS</code>ç±»å‹ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨<code>JSValue</code>å¯¹è±¡<code>API</code>æ–¹æ³•ï¼Œè§£æä¸º<code>OC</code>å¯¹è±¡ã€‚</p>
<h4 id="OCç‰ˆæœ¬-8"><a href="#OCç‰ˆæœ¬-8" class="headerlink" title="OCç‰ˆæœ¬"></a>OCç‰ˆæœ¬</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NSString *jsStr1 = @&quot;1+2&quot;;</span><br><span class="line">JSValue *value1 = [context evaluateScript:jsStr1]; // è¿”å›çš„JSValueå¯¹è±¡ï¼Œå­˜å‚¨çš„æ˜¯jsè®¡ç®—çš„è¿”å›ç»“æœã€‚ä¸å­˜å‚¨å®šä¹‰çš„å˜é‡ã€‚</span><br><span class="line">NSLog(@&quot;value1 JS: %@  -&gt; OC: %@&quot;,value1, value1.toNumber); // 3  3</span><br></pre></td></tr></table></figure>
<h4 id="Swiftç‰ˆæœ¬-8"><a href="#Swiftç‰ˆæœ¬-8" class="headerlink" title="Swiftç‰ˆæœ¬"></a>Swiftç‰ˆæœ¬</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MARK: æ‰§è¡Œå¸¦è¿”å›ç»“æœjsè„šæœ¬</span></span><br><span class="line"><span class="keyword">let</span> jsStr1 = <span class="string">"1+2"</span></span><br><span class="line"><span class="keyword">let</span> jsvalue1 = context.evaluateScript(jsStr1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"value1 JS: <span class="subst">\(String(describing: jsvalue1)</span>)  -&gt; Swift: <span class="subst">\(String(describing: jsvalue1?.toNumber()</span>))"</span>)</span><br><span class="line"><span class="comment">// value1 JS: Optional(3)  -&gt; Swift: Optional(3)</span></span><br></pre></td></tr></table></figure>
<h3 id="æ‰§è¡Œä¸å¸¦è¿”å›ç»“æœjsè„šæœ¬"><a href="#æ‰§è¡Œä¸å¸¦è¿”å›ç»“æœjsè„šæœ¬" class="headerlink" title="æ‰§è¡Œä¸å¸¦è¿”å›ç»“æœjsè„šæœ¬"></a>æ‰§è¡Œä¸å¸¦è¿”å›ç»“æœjsè„šæœ¬</h3><p>å¦‚æœæ‰§è¡Œçš„<code>js</code>è„šæœ¬æ²¡æœ‰è¿”å›ç»“æœï¼Œåˆ™<code>- (JSValue *)evaluateScript:(NSString *)script;</code>æ‰§è¡Œåè¿”å›çš„<code>JSValue</code>å¯¹è±¡ï¼Œè§£æä¸º<code>JS</code>æ˜¯ <code>undefined</code>ï¼Œå¯¹åº”çš„<code>OC</code>æ˜¯<code>(null)</code>ã€‚</p>
<h4 id="OCç‰ˆæœ¬-9"><a href="#OCç‰ˆæœ¬-9" class="headerlink" title="OCç‰ˆæœ¬"></a>OCç‰ˆæœ¬</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NSString *jsStr2 = @&quot;var a = 1; var b = 2;&quot;;</span><br><span class="line">JSValue *value2 = [context evaluateScript:jsStr2];</span><br><span class="line">NSLog(@&quot;value2 JS: %@  -&gt; OC: %@&quot;,value2, value2.toObject); // value2 JS: undefined  -&gt; OC: (null)</span><br></pre></td></tr></table></figure>
<h4 id="Swiftç‰ˆæœ¬-9"><a href="#Swiftç‰ˆæœ¬-9" class="headerlink" title="Swiftç‰ˆæœ¬"></a>Swiftç‰ˆæœ¬</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MARK: æ‰§è¡Œä¸å¸¦è¿”å›ç»“æœjsè„šæœ¬</span></span><br><span class="line"><span class="keyword">let</span> jsStr2 = <span class="string">"var a = 1; var b = 2;"</span></span><br><span class="line"><span class="keyword">let</span> jsvalue2 = context.evaluateScript(jsStr2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"value2 JS: <span class="subst">\(String(describing: jsvalue2)</span>)  -&gt; Swift: <span class="subst">\(String(describing: jsvalue2?.toObject)</span>)"</span>);</span><br><span class="line"><span class="comment">//value2 JS: Optional(undefined)  -&gt; Swift: Optional((Function))</span></span><br></pre></td></tr></table></figure>
<h3 id="å–å‡ºjsè„šæœ¬æ‰§è¡Œåå­˜å‚¨åœ¨JSContextå¯¹è±¡ä¸­çš„å˜é‡"><a href="#å–å‡ºjsè„šæœ¬æ‰§è¡Œåå­˜å‚¨åœ¨JSContextå¯¹è±¡ä¸­çš„å˜é‡" class="headerlink" title="å–å‡ºjsè„šæœ¬æ‰§è¡Œåå­˜å‚¨åœ¨JSContextå¯¹è±¡ä¸­çš„å˜é‡"></a>å–å‡ºjsè„šæœ¬æ‰§è¡Œåå­˜å‚¨åœ¨JSContextå¯¹è±¡ä¸­çš„å˜é‡</h3><p>å½“<code>JSContext</code>å¯¹è±¡è°ƒç”¨æ–¹æ³•<code>- (JSValue *)evaluateScript:(NSString *)script;</code>æ¥æ‰§è¡Œ<code>js</code>è„šæœ¬æ—¶ï¼Œä¼šæŠŠ<code>JS</code>ä¸­å®šä¹‰çš„å˜é‡å‡½æ•°ç­‰å­˜å‚¨åˆ°<code>JSContext</code>å¯¹è±¡ä¸­ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡<code>key-value</code>æ–¹æ³•å–å‡ºï¼Œå–å‡ºè·å¾—çš„æ˜¯<code>JSValue</code>å¯¹è±¡ã€‚è¿™æ ·å°±å¯ä»¥é€šè¿‡å–å‡ºçš„<code>JSValue</code>å¯¹è±¡è½¬æ¢<code>js</code>è„šæœ¬ä¸­å®šä¹‰çš„<code>JS</code>å˜é‡ä¸º<code>OC</code>å¯¹è±¡æ¥ä½¿ç”¨ï¼Œæˆ–å¯ä»¥é€šè¿‡å–å‡ºçš„<code>JSValue</code>å¯¹è±¡è°ƒç”¨<code>js</code>è„šæœ¬ä¸­å®šä¹‰çš„<code>JS</code>å‡½æ•°ã€‚ï¼ˆè°ƒç”¨<code>JSValue</code>çš„<code>API</code>ï¼‰</p>
<h4 id="OCç‰ˆæœ¬-10"><a href="#OCç‰ˆæœ¬-10" class="headerlink" title="OCç‰ˆæœ¬"></a>OCç‰ˆæœ¬</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">NSString *jsStr2 = @&quot;var a = 1; var b = 2;&quot;;</span><br><span class="line">JSValue *value2 = [context evaluateScript:jsStr2];</span><br><span class="line">JSValue *jsValueA = context[@&quot;a&quot;];  // è¿è¡Œjsï¼Œå®šä¹‰çš„å˜é‡ï¼Œå­˜å‚¨åœ¨contextä¸­ã€‚</span><br><span class="line">JSValue *jsValueB = context[@&quot;b&quot;];</span><br><span class="line">NSLog(@&quot;JS a: %@;  JS a: %@&quot;, jsValueA, jsValueB); // JS a: 1;  JS a: 2</span><br></pre></td></tr></table></figure>
<h4 id="Swiftç‰ˆæœ¬-10"><a href="#Swiftç‰ˆæœ¬-10" class="headerlink" title="Swiftç‰ˆæœ¬"></a>Swiftç‰ˆæœ¬</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MARK: å–å‡ºjsè„šæœ¬æ‰§è¡Œåå­˜å‚¨åœ¨JSContextå¯¹è±¡ä¸­çš„å˜é‡</span></span><br><span class="line"><span class="keyword">let</span> jsValueA = context.objectForKeyedSubscript(<span class="string">"a"</span>)</span><br><span class="line"><span class="keyword">let</span> jsValueB = context.objectForKeyedSubscript(<span class="string">"b"</span>)</span><br><span class="line"><span class="type">NSLog</span>(<span class="string">"JS a: <span class="subst">\(String(describing: jsValueA)</span>);  JS b: <span class="subst">\(String(describing: jsValueB)</span>)"</span>) <span class="comment">//  JS a: Optional(1);  JS b: Optional(2)</span></span><br></pre></td></tr></table></figure>
<h3 id="å–å‡ºå­˜å‚¨çš„jså˜é‡ï¼Œå¹¶ä¿®æ”¹"><a href="#å–å‡ºå­˜å‚¨çš„jså˜é‡ï¼Œå¹¶ä¿®æ”¹" class="headerlink" title="å–å‡ºå­˜å‚¨çš„jså˜é‡ï¼Œå¹¶ä¿®æ”¹"></a>å–å‡ºå­˜å‚¨çš„jså˜é‡ï¼Œå¹¶ä¿®æ”¹</h3><p>å¯¹äº<code>JS</code>çš„<code>Array</code>ã€<code>Object</code>ç±»å‹ï¼Œ<code>JSValue</code>ä¹Ÿå¯ä»¥é€šè¿‡ä¸‹æ ‡ç›´æ¥å–å€¼å’Œèµ‹å€¼ã€‚</p>
<h4 id="OCç‰ˆæœ¬-11"><a href="#OCç‰ˆæœ¬-11" class="headerlink" title="OCç‰ˆæœ¬"></a>OCç‰ˆæœ¬</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">NSString *jsStr3 = @&quot;var arr = [88, &apos;mengyueping&apos;, 66];&quot;;</span><br><span class="line">JSValue *value3 = [context evaluateScript:jsStr3];</span><br><span class="line">JSValue *jsArr = context[@&quot;arr&quot;];</span><br><span class="line">NSLog(@&quot;value3 JS: %@  -&gt; OC: %@&quot;,value3, value3.toObject); // value2 JS: undefined  -&gt; OC: (null)</span><br><span class="line">NSLog(@&quot;JS Array: %@;  Length: %@; jsArr[0]ï¼š%@&quot;, jsArr, jsArr[@&quot;length&quot;], jsArr[0]); // JS Array: 20,10,www.mengyueping.com;  Length: 3; jsArr[0]ï¼š20</span><br><span class="line">jsArr[0] = @&quot;www.&quot;;</span><br><span class="line">jsArr[2] = @&quot;.com&quot;;</span><br><span class="line">NSLog(@&quot;é€šè¿‡ä¸‹æ ‡å¯¹jså–å€¼èµ‹å€¼ï¼šJS Array: %@;  Length: %@; jsArr[0]ï¼š%@&quot;, jsArr, jsArr[@&quot;length&quot;], jsArr[0]); // JS Array: 20,10,www.mengyueping.com;  Length: 3; jsArr[0]ï¼š20</span><br></pre></td></tr></table></figure>
<h4 id="Swiftç‰ˆæœ¬-11"><a href="#Swiftç‰ˆæœ¬-11" class="headerlink" title="Swiftç‰ˆæœ¬"></a>Swiftç‰ˆæœ¬</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MARK: å–å‡ºå­˜å‚¨çš„jså˜é‡ï¼Œå¹¶ä¿®æ”¹</span></span><br><span class="line"><span class="keyword">let</span> jsStr3 = <span class="string">"var arr = [88, 'mengyueping', 66];"</span></span><br><span class="line"><span class="keyword">let</span> value3 = context.evaluateScript(jsStr3)</span><br><span class="line"><span class="keyword">let</span> jsArr = context.objectForKeyedSubscript(<span class="string">"arr"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"value3 JS: <span class="subst">\(String(describing: value3)</span>)  -&gt; Swift: <span class="subst">\(String(describing: value3?.toObject)</span>)"</span>);</span><br><span class="line"><span class="comment">// value3 JS: Optional(undefined)  -&gt; Swift: Optional((Function))</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"JS Array: <span class="subst">\(String(describing: jsArr)</span>);  Length: <span class="subst">\(String(describing: jsArr?.objectForKeyedSubscript("length")</span>)); jsArr[0]ï¼š<span class="subst">\(String(describing: jsArr?.objectAtIndexedSubscript(<span class="number">0</span>)</span>))"</span> )</span><br><span class="line"><span class="comment">// JS Array: Optional(88,mengyueping,66);  Length: Optional(3); jsArr[0]ï¼šOptional(88)</span></span><br><span class="line">jsArr?.setValue(<span class="string">"www."</span>, at: <span class="number">0</span>)</span><br><span class="line">jsArr?.setValue(<span class="string">".com"</span>, at: <span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"é€šè¿‡ä¸‹æ ‡å¯¹jså–å€¼èµ‹å€¼ï¼šJS Array: <span class="subst">\(String(describing: jsArr)</span>);  Length: <span class="subst">\(String(describing: jsArr?.objectForKeyedSubscript("length")</span>)); jsArr[0]ï¼š<span class="subst">\(String(describing: jsArr?.objectAtIndexedSubscript(<span class="number">0</span>)</span>))"</span> )</span><br><span class="line"><span class="comment">// é€šè¿‡ä¸‹æ ‡å¯¹jså–å€¼èµ‹å€¼ï¼šJS Array: Optional(www.,mengyueping,.com);  Length: Optional(3); jsArr[0]ï¼šOptional(www.)</span></span><br></pre></td></tr></table></figure>
<h3 id="å–å‡ºå­˜å‚¨çš„jsé›†åˆå¯¹è±¡ï¼Œå¹¶è½¬ä¸ºOCæ•°ç»„å¯¹è±¡"><a href="#å–å‡ºå­˜å‚¨çš„jsé›†åˆå¯¹è±¡ï¼Œå¹¶è½¬ä¸ºOCæ•°ç»„å¯¹è±¡" class="headerlink" title="å–å‡ºå­˜å‚¨çš„jsé›†åˆå¯¹è±¡ï¼Œå¹¶è½¬ä¸ºOCæ•°ç»„å¯¹è±¡"></a>å–å‡ºå­˜å‚¨çš„jsé›†åˆå¯¹è±¡ï¼Œå¹¶è½¬ä¸ºOCæ•°ç»„å¯¹è±¡</h3><h4 id="OCç‰ˆæœ¬-12"><a href="#OCç‰ˆæœ¬-12" class="headerlink" title="OCç‰ˆæœ¬"></a>OCç‰ˆæœ¬</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">NSString *jsStr3 = @&quot;var arr = [88, &apos;mengyueping&apos;, 66];&quot;;</span><br><span class="line">JSValue *value3 = [context evaluateScript:jsStr3];</span><br><span class="line">JSValue *jsArr = context[@&quot;arr&quot;];</span><br><span class="line">NSArray *ocArr = jsArr.toArray;</span><br><span class="line">NSLog(@&quot;js Arr -&gt; OC Arr: %@&quot;, ocArr);</span><br><span class="line">/*</span><br><span class="line">    js Arr -&gt; OC Arr: (</span><br><span class="line">    &quot;www.&quot;,</span><br><span class="line">    mengyueping,</span><br><span class="line">    &quot;.com&quot;</span><br><span class="line">    )</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>
<h4 id="Swiftç‰ˆæœ¬-12"><a href="#Swiftç‰ˆæœ¬-12" class="headerlink" title="Swiftç‰ˆæœ¬"></a>Swiftç‰ˆæœ¬</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> swiftArr = jsArr?.toArray()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"js Arr -&gt; Swift Arr: <span class="subst">\(String(describing: swiftArr)</span>)"</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">js Arr -&gt; Swift Arr: Optional([www., mengyueping, .com])</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h3 id="å–å‡ºå­˜å‚¨çš„jsé›†åˆå¯¹è±¡ï¼Œå¹¶ç›´æ¥ä½¿ç”¨OCå¯¹è±¡ç»™jså¯¹è±¡èµ‹å€¼"><a href="#å–å‡ºå­˜å‚¨çš„jsé›†åˆå¯¹è±¡ï¼Œå¹¶ç›´æ¥ä½¿ç”¨OCå¯¹è±¡ç»™jså¯¹è±¡èµ‹å€¼" class="headerlink" title="å–å‡ºå­˜å‚¨çš„jsé›†åˆå¯¹è±¡ï¼Œå¹¶ç›´æ¥ä½¿ç”¨OCå¯¹è±¡ç»™jså¯¹è±¡èµ‹å€¼"></a>å–å‡ºå­˜å‚¨çš„jsé›†åˆå¯¹è±¡ï¼Œå¹¶ç›´æ¥ä½¿ç”¨OCå¯¹è±¡ç»™jså¯¹è±¡èµ‹å€¼</h3><p><code>JSValue</code>æ˜¯éµå¾ª<code>JS</code>çš„æ•°ç»„ç‰¹æ€§ï¼šæ²¡æœ‰ä¸‹æ ‡è¶Šä½ï¼Œè‡ªåŠ¨å»¶å±•æ•°ç»„å¤§å°ã€‚å³ï¼šé›†åˆä¸­æ²¡æœ‰çš„ä¸‹æ ‡ï¼Œå…ƒç´ ä¼šè‡ªåŠ¨è¡¥ç©ºã€‚å¹¶ä¸”é€šè¿‡<code>JSValue</code>è¿˜å¯ä»¥è·å–<code>JS</code>å¯¹è±¡ä¸Šçš„å±æ€§ï¼Œæ¯”å¦‚ï¼šJSæ•°ç»„çš„é•¿åº¦â€œlengthâ€ã€‚</p>
<h4 id="OCç‰ˆæœ¬-13"><a href="#OCç‰ˆæœ¬-13" class="headerlink" title="OCç‰ˆæœ¬"></a>OCç‰ˆæœ¬</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">NSString *jsStr3 = @&quot;var arr = [88, &apos;mengyueping&apos;, 66];&quot;;</span><br><span class="line">JSValue *value3 = [context evaluateScript:jsStr3];</span><br><span class="line">JSValue *jsArr = context[@&quot;arr&quot;];</span><br><span class="line">jsArr[8] = @8;</span><br><span class="line">NSLog(@&quot;é€šè¿‡ä¸‹æ ‡å¯¹jså–å€¼èµ‹å€¼ï¼šJS Array: %@;  Length: %@; jsArr[0]ï¼š%@&quot;, jsArr, jsArr[@&quot;length&quot;], jsArr[0]);</span><br><span class="line">// é€šè¿‡ä¸‹æ ‡å¯¹jså–å€¼èµ‹å€¼ï¼šJS Array: www.,mengyueping,.com,,,,,,8;  Length: 9; jsArr[0]ï¼šwww.</span><br><span class="line">NSLog(@&quot;js Arr -&gt; OC Arr: %@&quot;, jsArr.toArray);</span><br><span class="line">/*</span><br><span class="line">    js Arr -&gt; OC Arr: (</span><br><span class="line">    &quot;www.&quot;,</span><br><span class="line">    mengyueping,</span><br><span class="line">    &quot;.com&quot;,</span><br><span class="line">    &quot;&lt;null&gt;&quot;,</span><br><span class="line">    &quot;&lt;null&gt;&quot;,</span><br><span class="line">    &quot;&lt;null&gt;&quot;,</span><br><span class="line">    &quot;&lt;null&gt;&quot;,</span><br><span class="line">    &quot;&lt;null&gt;&quot;,</span><br><span class="line">    8</span><br><span class="line">    )</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>
<h4 id="Swiftç‰ˆæœ¬-13"><a href="#Swiftç‰ˆæœ¬-13" class="headerlink" title="Swiftç‰ˆæœ¬"></a>Swiftç‰ˆæœ¬</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MARK: å–å‡ºå­˜å‚¨çš„jsé›†åˆå¯¹è±¡ï¼Œå¹¶ç›´æ¥ä½¿ç”¨Swiftå¯¹è±¡ç»™jså¯¹è±¡èµ‹å€¼</span></span><br><span class="line">jsArr?.setValue(<span class="number">8</span>, at: <span class="number">8</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"é€šè¿‡ä¸‹æ ‡å¯¹jså–å€¼èµ‹å€¼ï¼šJS Array: <span class="subst">\(String(describing: jsArr)</span>);  Length: <span class="subst">\(String(describing: jsArr?.objectForKeyedSubscript("length")</span>)); jsArr[0]ï¼š<span class="subst">\(String(describing: jsArr?.objectAtIndexedSubscript(<span class="number">0</span>)</span>))"</span> )</span><br><span class="line"><span class="comment">// é€šè¿‡ä¸‹æ ‡å¯¹jså–å€¼èµ‹å€¼ï¼šJS Array: Optional(www.,mengyueping,.com,,,,,,8);  Length: Optional(9); jsArr[0]ï¼šOptional(www.)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"js Arr -&gt; Swift Arr: <span class="subst">\(String(describing: jsArr?.toArray()</span>))"</span>)</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">js Arr -&gt; Swift Arr: Optional([www., mengyueping, .com, &lt;null&gt;, &lt;null&gt;, &lt;null&gt;, &lt;null&gt;, &lt;null&gt;, 8])</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h3 id="å–å‡ºå­˜å‚¨çš„jså‡½æ•°ï¼Œå¹¶æ‰§è¡Œ"><a href="#å–å‡ºå­˜å‚¨çš„jså‡½æ•°ï¼Œå¹¶æ‰§è¡Œ" class="headerlink" title="å–å‡ºå­˜å‚¨çš„jså‡½æ•°ï¼Œå¹¶æ‰§è¡Œ"></a>å–å‡ºå­˜å‚¨çš„jså‡½æ•°ï¼Œå¹¶æ‰§è¡Œ</h3><p>ä½¿ç”¨<code>JSValue</code>çš„<code>API</code>æ‰§è¡Œ<code>JS</code>å‡½æ•°ï¼Œä¸”æœ‰å‚æ•°çš„ï¼Œå¯ä»¥ä¼ å‚ã€‚</p>
<h4 id="OCç‰ˆæœ¬-14"><a href="#OCç‰ˆæœ¬-14" class="headerlink" title="OCç‰ˆæœ¬"></a>OCç‰ˆæœ¬</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[context evaluateScript:@&quot;function add(a, b)&#123; return a + b; &#125;&quot;];</span><br><span class="line">JSValue *addValue = context[@&quot;add&quot;]; // jså‡½æ•°</span><br><span class="line">NSLog(@&quot;Func: %@&quot;, addValue);  // Func: function add(a, b)&#123; return a + b; &#125;</span><br><span class="line"></span><br><span class="line">// å–å‡ºjså‡½æ•°ï¼Œè°ƒç”¨å‡½æ•° - (JSValue *)callWithArguments:(NSArray *)arguments;</span><br><span class="line">JSValue *sum = [addValue callWithArguments:@[@1,@2]];</span><br><span class="line">NSLog(@&quot;Sum: %d&quot;, sum.toInt32); // Sum: 3</span><br></pre></td></tr></table></figure>
<h4 id="Swiftç‰ˆæœ¬-14"><a href="#Swiftç‰ˆæœ¬-14" class="headerlink" title="Swiftç‰ˆæœ¬"></a>Swiftç‰ˆæœ¬</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MARK: å–å‡ºå­˜å‚¨çš„jså‡½æ•°ï¼Œå¹¶æ‰§è¡Œ</span></span><br><span class="line">context.evaluateScript(<span class="string">"function add(a, b)&#123; return a + b; &#125;"</span>)</span><br><span class="line"><span class="keyword">let</span> addValue = context.objectForKeyedSubscript(<span class="string">"add"</span>) <span class="comment">// jså‡½æ•°</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"Func: <span class="subst">\(String(describing: addValue)</span>)"</span>)  <span class="comment">// Func: Optional(function add(a, b)&#123; return a + b; &#125;)</span></span><br><span class="line"><span class="comment">// å–å‡ºjså‡½æ•°ï¼Œè°ƒç”¨å‡½æ•° open func call(withArguments arguments: [Any]!) -&gt; JSValue!</span></span><br><span class="line"><span class="keyword">let</span> sum = addValue?.call(withArguments:[<span class="number">1</span>,<span class="number">2</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"Sum: <span class="subst">\(String(describing: sum?.toInt32()</span>))"</span>) <span class="comment">// Sum: Optional(3)</span></span><br></pre></td></tr></table></figure>
<h3 id="è°ƒç”¨jså‡½æ•°çš„å¦ä¸€ç§ç®€å•æ–¹æ³•"><a href="#è°ƒç”¨jså‡½æ•°çš„å¦ä¸€ç§ç®€å•æ–¹æ³•" class="headerlink" title="è°ƒç”¨jså‡½æ•°çš„å¦ä¸€ç§ç®€å•æ–¹æ³•"></a>è°ƒç”¨jså‡½æ•°çš„å¦ä¸€ç§ç®€å•æ–¹æ³•</h3><p>ä¸å¿…åƒä¸Šé¢ä¸€æ ·å…ˆå–å‡ºå­˜å‚¨çš„<code>JS</code>å‡½æ•°ï¼Œå†æ‰§è¡Œ<code>JS</code>å‡½æ•°ã€‚ç›´æ¥ä½¿ç”¨<code>JSContext</code>å¯¹è±¡çš„<code>JSValue *globalObject;</code>å±æ€§ï¼Œè°ƒç”¨<code>JSValue</code>å¯¹è±¡çš„<code>- (JSValue *)invokeMethod:(NSString *)method withArguments:(NSArray *)arguments;</code>æ–¹æ³•ã€‚å¦‚æœå®šä¹‰çš„<code>JS</code>å‡½æ•°æ˜¯å…¨å±€å‡½æ•°ï¼Œåº”è¯¥ç”¨<code>JSContext</code>çš„<code>globalObject</code>å¯¹è±¡è°ƒç”¨è¯¥æ–¹æ³•ã€‚å¦‚æœæ˜¯æŸ<code>JS</code>å¯¹è±¡çš„æ–¹æ³•ï¼Œå°±åº”è¯¥ç”¨ç›¸åº”çš„<code>JSValue</code>å¯¹è±¡è°ƒç”¨ã€‚</p>
<h4 id="OCç‰ˆæœ¬-15"><a href="#OCç‰ˆæœ¬-15" class="headerlink" title="OCç‰ˆæœ¬"></a>OCç‰ˆæœ¬</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">JSValue *jsValue = [context evaluateScript:@&quot;function multiply(a, b)&#123; return a * b; &#125;&quot;];</span><br><span class="line">JSValue *multiplyValue = [jsValue.context.globalObject invokeMethod:@&quot;multiply&quot; withArguments:@[@3,@6]]; //ç¬¬ä¸€ç§å½¢å¼</span><br><span class="line">NSLog(@&quot;multiplyValue: %d&quot;,multiplyValue.toInt32); // multiplyValue: 18</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">JSValue *jsValue = [context evaluateScript:@&quot;function multiply(a, b)&#123; return a * b; &#125;&quot;];</span><br><span class="line">JSValue *multiplyValue = [context.globalObject invokeMethod:@&quot;multiply&quot; withArguments:@[@3,@6]]; //ç¬¬äºŒç§å½¢å¼</span><br><span class="line">NSLog(@&quot;multiplyValue: %d&quot;,multiplyValue.toInt32); // multiplyValue: 18</span><br></pre></td></tr></table></figure></p>
<h4 id="Swiftç‰ˆæœ¬-15"><a href="#Swiftç‰ˆæœ¬-15" class="headerlink" title="Swiftç‰ˆæœ¬"></a>Swiftç‰ˆæœ¬</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MARK:  è°ƒç”¨jså‡½æ•°çš„å¦ä¸€ç§ç®€å•æ–¹æ³•</span></span><br><span class="line"><span class="keyword">let</span> jsValue = context.evaluateScript(<span class="string">"function multiply(a, b)&#123; return a * b; &#125;"</span>)</span><br><span class="line"><span class="keyword">let</span> multiplyValue = jsValue?.context.globalObject.invokeMethod(<span class="string">"multiply"</span>, withArguments: [<span class="number">3</span>,<span class="number">6</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"multiplyValue: <span class="subst">\(String(describing: multiplyValue?.toInt32()</span>))"</span>); <span class="comment">// multiplyValue: Optional(18)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> multiplyValue = context.globalObject.invokeMethod(<span class="string">"multiply"</span>, withArguments: [<span class="number">3</span>,<span class="number">6</span>])</span><br></pre></td></tr></table></figure>
<h3 id="æŠŠOCä¸­Blockè½¬æ¢æˆJSå‡½æ•°ï¼Œå¹¶å­˜å‚¨åˆ°JSContextå¯¹è±¡"><a href="#æŠŠOCä¸­Blockè½¬æ¢æˆJSå‡½æ•°ï¼Œå¹¶å­˜å‚¨åˆ°JSContextå¯¹è±¡" class="headerlink" title="æŠŠOCä¸­Blockè½¬æ¢æˆJSå‡½æ•°ï¼Œå¹¶å­˜å‚¨åˆ°JSContextå¯¹è±¡"></a>æŠŠOCä¸­Blockè½¬æ¢æˆJSå‡½æ•°ï¼Œå¹¶å­˜å‚¨åˆ°JSContextå¯¹è±¡</h3><p>é€šè¿‡<code>Block</code>å¯ä»¥å®ç°åœ¨<code>OC/Swift</code>ä¸­å®šä¹‰<code>JS</code>å‡½æ•°ï¼Œå¹¶ä¸”åœ¨<code>JS</code>è¿è¡Œç¯å¢ƒä¸­è°ƒç”¨è¯¥<code>JS</code>å‡½æ•°ï¼Œå‡½æ•°æ‰§è¡Œå¯ä»¥æˆåŠŸçš„å›åˆ°<code>OC/Swift</code>çš„<code>Block/Closure</code>ä»£ç ä¸­ï¼Œè€Œä¸”éµå¾ª<code>JS</code>æ–¹æ³•çš„å„ç§ç‰¹ç‚¹ï¼ˆæ¯”å¦‚ï¼šæ–¹æ³•å‚æ•°ä¸å›ºå®šï¼‰ã€‚<code>JSContext</code>æä¾›äº†ç±»æ–¹æ³•æ¥è·å–å‚æ•°åˆ—è¡¨ <code>(+(NSArray *)currentArguments)</code>å’Œå½“å‰è°ƒç”¨è¯¥æ–¹æ³•çš„å¯¹è±¡<code>(+ (JSValue *)currentThis)</code>ã€‚<code>JS</code>å‡½æ•°ä¸­<code>this</code>çš„è¾“å‡ºçš„å†…å®¹æ˜¯<code>GlobalObject</code>ï¼Œä¹Ÿæ˜¯<code>JSContext</code>å¯¹è±¡æ–¹æ³• <code>-(JSValue *)globalObject;</code>æ‰€è¿”å›çš„å†…å®¹ã€‚å› ä¸ºåœ¨<code>JS</code>é‡Œé¢ï¼Œæ‰€æœ‰å…¨å±€å˜é‡å’Œæ–¹æ³•å…¶å®éƒ½æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡(<code>GlobalObject</code>)çš„å±æ€§ï¼Œåœ¨æµè§ˆå™¨ä¸­æ˜¯<code>window</code>å¯¹è±¡ã€‚å¦‚ä¸‹ï¼Œä½¿ç”¨<code>Block/Closure</code>å®šä¹‰ä¸€ä¸ª<code>JS</code>å‡½æ•°<code>log</code>ã€‚å¹¶åœ¨<code>JS</code>è„šæœ¬ä¸­è°ƒç”¨<code>log</code>å‡½æ•°ï¼Œå¹¶ä½¿ç”¨<code>OC</code>æ‰§è¡Œæ­¤è„šæœ¬ã€‚</p>
<h4 id="OCç‰ˆæœ¬-16"><a href="#OCç‰ˆæœ¬-16" class="headerlink" title="OCç‰ˆæœ¬"></a>OCç‰ˆæœ¬</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">context[@&quot;log&quot;] = ^()&#123;</span><br><span class="line">    NSLog(@&quot;++++++Begin Log++++++&quot;);</span><br><span class="line">    </span><br><span class="line">    NSArray *args = [JSContext currentArguments];</span><br><span class="line">    for (JSValue *jsVal in args) &#123;</span><br><span class="line">        NSLog(@&quot;%@&quot;,jsVal);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    JSValue *this = [JSContext currentThis];</span><br><span class="line">    NSLog(@&quot;this: %@&quot;, this);</span><br><span class="line">    </span><br><span class="line">    NSLog(@&quot;---End Log------&quot;);</span><br><span class="line">&#125;;</span><br><span class="line">// æ‰§è¡Œjsï¼Œè°ƒç”¨ä½¿ç”¨Blockè‡ªå®šä¹‰çš„jså‡½æ•°</span><br><span class="line">[context evaluateScript:@&quot;log(&apos;mengyueping&apos;, [10,20], &#123;&apos;hello&apos;: &apos;world&apos;, &apos;number&apos;: &apos;100&apos;&#125;)&quot;];</span><br><span class="line">/*</span><br><span class="line">    ++++++Begin Log++++++</span><br><span class="line">    mengyueping</span><br><span class="line">    10,20</span><br><span class="line">    [object Object]</span><br><span class="line">    this: [object GlobalObject]</span><br><span class="line">    ---End Log------</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>
<h4 id="Swiftç‰ˆæœ¬-16"><a href="#Swiftç‰ˆæœ¬-16" class="headerlink" title="Swiftç‰ˆæœ¬"></a>Swiftç‰ˆæœ¬</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MARK: æŠŠSwiftä¸­Closureè½¬æ¢æˆJSå‡½æ•°ï¼Œå¹¶å­˜å‚¨åˆ°JSContextå¯¹è±¡</span></span><br><span class="line"><span class="keyword">let</span> block: <span class="meta">@convention</span>(block) () -&gt; () = &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"++++++Begin Log++++++"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> args = <span class="type">JSContext</span>.currentArguments()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> jsVal <span class="keyword">in</span> args! &#123;</span><br><span class="line">        <span class="built_in">print</span>(jsVal)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> this = <span class="type">JSContext</span>.currentThis()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"this: <span class="subst">\(String(describing: this)</span>)"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"---End Log------"</span>)</span><br><span class="line">&#125;</span><br><span class="line">context.setObject(block, forKeyedSubscript: <span class="type">NSString</span>(string: <span class="string">"log"</span>))</span><br><span class="line"><span class="comment">// æ‰§è¡Œjsï¼Œè°ƒç”¨ä½¿ç”¨Blockè‡ªå®šä¹‰çš„jså‡½æ•°</span></span><br><span class="line">context.evaluateScript(<span class="string">"log('mengyueping', [10,20], &#123;'hello': 'world', 'number': '100'&#125;)"</span>)</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">++++++Begin Log++++++</span></span><br><span class="line"><span class="comment">mengyueping</span></span><br><span class="line"><span class="comment">10,20</span></span><br><span class="line"><span class="comment">[object Object]</span></span><br><span class="line"><span class="comment">this: Optional([object GlobalObject])</span></span><br><span class="line"><span class="comment">---End Log------</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>å¯¹<code>JSContext</code>å’Œ<code>JSValue</code>å®ä¾‹ä½¿ç”¨ä¸‹æ ‡çš„æ–¹å¼æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°è®¿é—®æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„<code>context</code>çš„ä»»ä½•å€¼ã€‚<code>JSContext</code>éœ€è¦ä¸€ä¸ªå­—ç¬¦ä¸²ä¸‹æ ‡ï¼Œè€Œ<code>JSValue</code>å…è®¸ä½¿ç”¨å­—ç¬¦ä¸²æˆ–æ•´æ•°ä½œä¸ºä¸‹æ ‡æ¥å¾—åˆ°é‡Œé¢çš„<code>JS</code>å¯¹è±¡å’Œæ•°ç»„ã€‚</p>
<p><code>Block</code>å¯ä»¥ä¼ å…¥<code>JSContext</code>ä½œæ–¹æ³•ï¼Œä½†æ˜¯<code>JSValue</code>æ²¡æœ‰<code>toBlock</code>æ–¹æ³•æ¥æŠŠ<code>JS</code>æ–¹æ³•å˜æˆ<code>Block/Closure</code>åœ¨<code>OC/Swift</code>ä¸­ä½¿ç”¨ã€‚ä½†æ˜¯ï¼Œ<code>JSValue</code>æä¾›äº†<code>-(JSValue *)callWithArguments:(NSArray *)arguments;</code>æ–¹æ³•ï¼Œå¯ä»¥åè¿‡æ¥å°†å‡½æ•°å‚æ•°ä¼ è¿›å»ã€‚</p>
<p><code>Block</code>åœ¨<code>JavaScriptCore</code>ä¸­èµ·åˆ°å¼ºå¤§ä½œç”¨ï¼Œå®ƒä¸º<code>JS</code>å’Œ<code>OC</code>ä¹‹é—´çš„è½¬æ¢å»ºç«‹èµ·æ›´å¤šçš„æ¡¥æ¢ï¼Œè®©è½¬æ¢æ›´æ–¹ä¾¿ã€‚ä½†éœ€è¦æ³¨æ„ï¼š</p>
<ul>
<li>åœ¨<code>block</code>å†…éƒ¨ä½¿ç”¨å¤–éƒ¨å®šä¹‰åˆ›å»ºçš„å¯¹è±¡ï¼Œ<code>block</code>ä¼šå¯¹å…¶åšå¼ºå¼•ç”¨ï¼Œè€Œ<code>JSContext</code>ä¹Ÿä¼šå¯¹è¢«èµ‹äºˆçš„<code>block</code>åšå¼ºå¼•ç”¨ï¼Œè¿™æ ·å®ƒä»¬ä¹‹é—´å°±å½¢æˆäº†å¾ªç¯å¼•ç”¨<code>ï¼ˆCircular Referenceï¼‰</code>ä½¿å¾—å†…å­˜æ— æ³•æ­£å¸¸é‡Šæ”¾ã€‚</li>
<li>åœ¨<code>block</code>å†…éƒ¨ä½¿ç”¨å¤–éƒ¨å®šä¹‰åˆ›å»ºçš„<code>JSValue</code>å¯¹è±¡ï¼Œä¹Ÿä¼šé€ æˆå¾ªç¯å¼•ç”¨ï¼Œå› ä¸ºæ¯ä¸ª<code>JSValue</code>ä¸Šéƒ½æœ‰<code>JSContext</code>çš„å¼•ç”¨<code>ï¼ˆ@property (readonly, strong) JSContext *context;ï¼‰</code>ï¼Œ<code>JSContext</code>å†å¼•ç”¨<code>Block</code>åŒæ ·ä¹Ÿä¼šå½¢æˆå¾ªç¯å¼•ç”¨ã€‚</li>
<li>æ— è®ºæ˜¯æŠŠ<code>Block</code>ä¼ ç»™<code>JSContext</code>å¯¹è±¡ï¼Œè®©å…¶å˜æˆ<code>JS</code>æ–¹æ³•ï¼›è¿˜æ˜¯æŠŠå®ƒèµ‹å€¼ç»™<code>exceptionHandler</code>å±æ€§ï¼›åœ¨<code>Block</code>å†…éƒ½ä¸è¦ç›´æ¥ä½¿ç”¨å…¶å¤–éƒ¨å®šä¹‰çš„<code>JSContext/JSValue</code>å¯¹è±¡ï¼Œåº”è¯¥å°†å…¶å½“åšå‚æ•°ä¼ å…¥åˆ°<code>Block</code>ä¸­ï¼Œæˆ–è€…é€šè¿‡<code>JSContext</code>çš„ç±»æ–¹æ³•<code>+(JSContext *)currentContext;</code>æ¥è·å¾—ã€‚å¦åˆ™ä¼šé€ æˆå¾ªç¯å¼•ç”¨ä½¿å¾—å†…å­˜æ— æ³•è¢«æ­£ç¡®é‡Šæ”¾ã€‚</li>
</ul>
<h2 id="JSContextç»“åˆUIWebViewå¤„ç†HTMLä¸­äº‹ä»¶ç›‘å¬"><a href="#JSContextç»“åˆUIWebViewå¤„ç†HTMLä¸­äº‹ä»¶ç›‘å¬" class="headerlink" title="JSContextç»“åˆUIWebViewå¤„ç†HTMLä¸­äº‹ä»¶ç›‘å¬"></a>JSContextç»“åˆUIWebViewå¤„ç†HTMLä¸­äº‹ä»¶ç›‘å¬</h2><p><code>JSContext</code>ç»“åˆ<code>UIWebView</code>ï¼Œå½“ç‚¹å‡»<code>JS</code>å‡½æ•°æ—¶ï¼Œå“åº”<code>OC/Swift</code>æ“ä½œã€‚é€šè¿‡<code>UIWebView</code>çš„æ–¹æ³•<code>JSContext *context = [self.webView valueForKeyPath:@&quot;documentView.webView.mainFrame.javaScriptContext&quot;];</code>è·å–<code>JSContext</code>å¯¹è±¡ã€‚ <code>Swift</code>ä¸­æ˜¯<code>let context = webView.value(forKeyPath: &quot;documentView.webView.mainFrame.javaScriptContext&quot;)</code>ã€‚</p>
<p>è€Œ<code>WKWebView</code>ä¸æ”¯æŒé€šè¿‡<code>KVC</code>çš„æ–¹å¼åˆ›å»º<code>JSContext</code>ï¼Œæ‰€ä»¥ä¸èƒ½åœ¨<code>WKWebView</code>ä¸­ä½¿ç”¨<code>JavaScriptCore</code>ã€‚<br><code>WKWebView</code>ä¸­<code>OC/Swift</code>ä¸<code>JS</code>äº¤äº’çš„æ–¹å¼ï¼Œæ›´ç®€æ´ï¼Œå› æ­¤ä¹Ÿç”¨ä¸åˆ°<code>JavaScriptCore</code>ã€‚</p>
<h3 id="åŠ è½½çš„HTML"><a href="#åŠ è½½çš„HTML" class="headerlink" title="åŠ è½½çš„HTML"></a>åŠ è½½çš„HTML</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>JavaScriptCore<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">            function showAlert(content) &#123;</span></span><br><span class="line"><span class="undefined">                asyncAlert(content);</span></span><br><span class="line"><span class="undefined">                document.getElementById("js-iOS-js-argsValue").value = content;</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">            function asyncAlert(content) &#123;</span></span><br><span class="line"><span class="undefined">                setTimeout(function()&#123; alert(content); &#125;, 1);</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>è¿™æ˜¯æŒ‰é’®è°ƒç”¨<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">'jsBtn'</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">style</span>=<span class="string">"width:300px;height:50px;"</span> <span class="attr">value</span>=<span class="string">"ç‚¹å‡»HtmlæŒ‰é’®ï¼Œè°ƒç”¨OC/Swiftè¦æ‰§è¡Œçš„ä»£ç ï¼Œ&amp;#13;&amp;#10;æ¥æ”¶JSä¼ é€’ç»™OC/Swiftçš„å‚æ•°"</span> <span class="attr">onclick</span>=<span class="string">"handleJSToiOS('è§¦å‘äº†Htmlä¸­æ ‡ç­¾çš„ç‚¹å‡»äº‹ä»¶ï¼Œè§¦å‘JSå‡½æ•°è°ƒç”¨ï¼Œjs-&gt;OC/Swift-&gt;JS')"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">id</span> =<span class="string">"js-iOS-js-argsValue"</span> <span class="attr">type</span>=<span class="string">"value"</span> <span class="attr">rows</span>=<span class="string">"5"</span> <span class="attr">cols</span>=<span class="string">"50"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="OCç‰ˆæœ¬-17"><a href="#OCç‰ˆæœ¬-17" class="headerlink" title="OCç‰ˆæœ¬"></a>OCç‰ˆæœ¬</h3><p>ä»£ç <code>context[@&quot;jsMethodName&quot;] = ^(){//æ‰§è¡Œçš„OCä»£ç };</code>å…¶ä¸­ï¼Œ<code>jsMethodName</code>æ˜¯<code>JS</code>ä¸­è§¦å‘äº‹ä»¶çš„æ–¹æ³•åå­—ï¼›<code>^(){//æ‰§è¡Œçš„OCä»£ç }</code> è¿™ä¸ª<code>block</code>é€šè¿‡<code>JSContext</code>å¯¹è±¡å˜æˆåå­—ä¸º<code>jsMethodName</code>çš„<code>JS</code>æ–¹æ³•ï¼›æ‰€ä»¥å½“è§¦å‘<code>Html</code>ç‚¹å‡»äº‹ä»¶æ‰€ç›‘å¬çš„<code>jsMethodName</code>æ–¹æ³•æ—¶ï¼Œå°±ç­‰äºè§¦å‘äº†<code>OC</code>çš„<code>Block</code>ä¸­çš„ä»£ç ã€‚</p>
<p><code>Block</code>ä¸­çš„æ‰§è¡Œç¯å¢ƒæ˜¯å­çº¿ç¨‹ã€‚å¯ä»¥æ›´æ–°éƒ¨åˆ†<code>UI</code>ï¼š<code>view</code>è®¾ç½®èƒŒæ™¯è‰²ã€è°ƒç”¨<code>webView</code>æ‰§è¡Œ<code>js</code>ã€‚å¼¹å‡ºåŸç”Ÿ<code>alertView</code>ä¼š<code>Crash</code>å­çº¿ç¨‹æ“ä½œ<code>UI</code>çš„é”™è¯¯ä¿¡æ¯ã€‚ </p>
<p><code>Block</code>é¿å…å¾ªç¯å¼•ç”¨ï¼Œå› ä¸º<code>block</code>ä¼šæŒæœ‰å¤–éƒ¨å˜é‡ï¼Œè€Œ<code>JSContext</code>ä¹Ÿä¼šå¼ºå¼•ç”¨å®ƒæ‰€æœ‰çš„å˜é‡ï¼Œ<code>self</code>ä½¿ç”¨<code>weakSelf</code>ã€‚<code>block</code>å†…ä¸è¦ä½¿ç”¨å¤–éƒ¨çš„<code>JSContext</code>å¯¹è±¡ã€<code>JSValue</code>å¯¹è±¡ã€‚å¦‚æœè¦ä½¿ç”¨<code>JSContext</code>å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨<code>[JSContext currentContext]</code>ï¼Œä¹Ÿå¯ä»¥æŠŠ<code>JSContext</code>å¯¹è±¡ã€<code>JSValue</code>å¯¹è±¡å½“åš<code>block</code>çš„å‚æ•°ä¼ å…¥ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">self.view.backgroundColor = [UIColor whiteColor];</span><br><span class="line">CGRect webFrame = CGRectMake(30, 80, self.view.bounds.size.width-60, self.view.bounds.size.height-100);</span><br><span class="line">UIWebView *webView = [[UIWebView alloc] initWithFrame:webFrame];</span><br><span class="line">NSURL *htmlUrl = [[NSBundle mainBundle] URLForResource:@&quot;index.html&quot; withExtension:nil];</span><br><span class="line">//    NSURL *htmlUrl = [NSURL URLWithString:@&quot;&quot;];</span><br><span class="line">NSURLRequest *request = [NSURLRequest requestWithURL:htmlUrl];</span><br><span class="line"></span><br><span class="line">webView.scrollView.bounces = NO; //å…³é—­webViewçš„å›å¼¹æ•ˆæœ</span><br><span class="line">webView.scrollView.decelerationRate = UIScrollViewDecelerationRateNormal;//UIWebViewæ»šåŠ¨çš„æ¯”è¾ƒæ…¢ï¼Œè¿™é‡Œè®¾ç½®ä¸ºæ­£å¸¸é€Ÿåº¦</span><br><span class="line"></span><br><span class="line">[webView loadRequest:request];</span><br><span class="line">[self.view addSubview:webView];</span><br><span class="line">self.webView = webView;</span><br><span class="line">self.webView.delegate = self;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - UIWebViewDelegate</span><br><span class="line">- (void)webViewDidFinishLoad:(UIWebView *)webView</span><br><span class="line">&#123;</span><br><span class="line">    __weak typeof (self) weakSelf = self;</span><br><span class="line">    </span><br><span class="line">    JSContext *context = [self.webView valueForKeyPath:@&quot;documentView.webView.mainFrame.javaScriptContext&quot;];</span><br><span class="line">    </span><br><span class="line">    context[@&quot;handleJSToiOS&quot;] = ^()&#123;</span><br><span class="line">        NSLog(@&quot;CurrentThread: %@&quot;,[NSThread currentThread]); //æ­¤Blockæ˜¯å­çº¿ç¨‹</span><br><span class="line">        </span><br><span class="line">        // è·å–jså‡½æ•°ä¼ å…¥çš„å‚æ•°</span><br><span class="line">        NSArray *args = [JSContext currentArguments];</span><br><span class="line">        for (int i = 0; i&lt;args.count; i++) &#123;</span><br><span class="line">            NSLog(@&quot;args[%d]: %@&quot;,i,args[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // ä½¿ç”¨JSContextæ‰§è¡ŒJSä»£ç ï¼Œå°†JSä¼ é€’ç»™OC/Swiftçš„æ•°æ®ï¼Œä¼ é€’å›JS</span><br><span class="line">        //æ–¹æ³•ä¸€ï¼š</span><br><span class="line">        NSString *jsStr = [NSString stringWithFormat:@&quot;showAlert(&apos;%@&apos;)&quot;,args[0]];</span><br><span class="line">        [[JSContext currentContext] evaluateScript:jsStr];</span><br><span class="line">        </span><br><span class="line">        //æ–¹æ³•äºŒï¼š</span><br><span class="line">        [[JSContext currentContext][@&quot;showAlert&quot;] callWithArguments:args];</span><br><span class="line">        </span><br><span class="line">        // ä¿®æ”¹åŸç”ŸUI</span><br><span class="line">        dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(0.1 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123;  //å›åˆ°ä¸»çº¿ç¨‹</span><br><span class="line">            </span><br><span class="line">            weakSelf.view.backgroundColor = [UIColor orangeColor];</span><br><span class="line">            </span><br><span class="line">            // BOMæ“ä½œ</span><br><span class="line">//            [weakSelf.webView goBack];</span><br><span class="line">//            [weakSelf.webView goForward];</span><br><span class="line">//            [weakSelf.webView reload];</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        // æ’­æ”¾ç³»ç»ŸéŸ³æ•ˆ</span><br><span class="line">        AudioServicesPlaySystemSound(1007); // 1007æ˜¯ç³»ç»Ÿå£°éŸ³çš„ç¼–å·</span><br><span class="line">        </span><br><span class="line">        /*</span><br><span class="line">         æ­¤å¤„å¯ä»¥æ‰§è¡Œçš„ä»»åŠ¡ï¼š</span><br><span class="line">             è·å–åœ°ç†ä½ç½®ä¿¡æ¯ã€è°ƒç”¨ç›¸æœºã€æ‰«ä¸€æ‰«äºŒç»´ç ã€è°ƒç”¨ç³»ç»Ÿåˆ†äº«é¢æ¿ã€æ›´æ”¹åŸç”Ÿæ§ä»¶å±æ€§æ ·å¼ï¼ˆå›åˆ°ä¸»çº¿ç¨‹ï¼‰ã€</span><br><span class="line">             åŸç”Ÿè°ƒç”¨æ”¯ä»˜ï¼ˆJSæŠŠæ”¯ä»˜å‚æ•°ä¼ é€’ç»™OC/Swfitè¿›è¡Œæ”¯ä»˜ã€OC/SwfitæŠŠæ”¯ä»˜ç»“æœåé¦ˆç»™JSï¼‰ã€</span><br><span class="line">             æ‘‡ä¸€æ‘‡ã€æ’­æ”¾ç³»ç»ŸéŸ³æ•ˆã€</span><br><span class="line">         */</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Swiftç‰ˆæœ¬-17"><a href="#Swiftç‰ˆæœ¬-17" class="headerlink" title="Swiftç‰ˆæœ¬"></a>Swiftç‰ˆæœ¬</h3><p>ä»£ç <code>jscontext.setObject(block, forKeyedSubscript: NSString(string: &quot;handleJSToiOS&quot;))</code>å…¶ä¸­ï¼Œ<code>block</code>æ˜¯è‡ªå·±å®šä¹‰çš„ä¸€ä¸ª<code>@convention(block)</code>çš„<code>Closure</code>ï¼›<code>handleJSToiOS</code>æ˜¯<code>JS</code>ä¸­è§¦å‘äº‹ä»¶çš„æ–¹æ³•åå­—ï¼›è¿™ä¸ªè‡ªå®šä¹‰çš„é—­åŒ…é€šè¿‡<code>JSContext</code>å¯¹è±¡ï¼Œå°†å­˜å‚¨çš„ä»£ç å—å˜æˆåå­—ä¸º<code>jsMethodName</code>çš„<code>JS</code>æ–¹æ³•ï¼›æ‰€ä»¥å½“è§¦å‘<code>Html</code>ç‚¹å‡»äº‹ä»¶æ‰€ç›‘å¬çš„<code>jsMethodName</code>æ–¹æ³•æ—¶ï¼Œå°±ç­‰äºè§¦å‘äº†<code>Swift</code>çš„<code>Closure</code>ä¸­çš„ä»£ç ã€‚</p>
<p> <code>Closure</code>ä¸­çš„æ‰§è¡Œç¯å¢ƒæ˜¯å­çº¿ç¨‹ã€‚å¯ä»¥æ›´æ–°éƒ¨åˆ†<code>UI</code>ï¼š<code>view</code>è®¾ç½®èƒŒæ™¯è‰²ã€è°ƒç”¨<code>webView</code>æ‰§è¡Œ<code>js</code>ã€‚å¼¹å‡ºåŸç”Ÿ<code>alertView</code>ä¼š<code>Crash</code>å­çº¿ç¨‹æ“ä½œ<code>UI</code>çš„é”™è¯¯ä¿¡æ¯ã€‚</p>
<p><code>Closure</code>é¿å…å¾ªç¯å¼•ç”¨ï¼Œå› ä¸º<code>Closure</code>ä¼šæŒæœ‰å¤–éƒ¨å˜é‡ï¼Œè€Œ<code>JSContext</code>ä¹Ÿä¼šå¼ºå¼•ç”¨å®ƒæ‰€æœ‰çš„å˜é‡ï¼Œé—­åŒ…ä¸­å£°æ˜<code>self</code>ä¸ºå¼±å¼•ç”¨<code>[weak self]</code>ã€‚<code>Closure</code>å†…ä¸è¦ä½¿ç”¨å¤–éƒ¨çš„<code>JSContext</code>å¯¹è±¡ã€<code>JSValue</code>å¯¹è±¡ã€‚å¦‚æœè¦ä½¿ç”¨<code>JSContext</code>å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨<code>JSContext.current()</code>ï¼Œä¹Ÿå¯ä»¥æŠŠ<code>JSContext</code>å¯¹è±¡ã€<code>JSValue</code>å¯¹è±¡å½“åš<code>Closure</code>çš„å‚æ•°ä¼ å…¥ã€‚<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(#function)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">lazy</span> <span class="keyword">var</span> webView: <span class="type">UIWebView</span> = &#123;</span><br><span class="line">        <span class="keyword">let</span> web = <span class="type">UIWebView</span>(frame: <span class="type">CGRect</span>(x: <span class="number">30</span>, y: <span class="number">80</span>, width: <span class="type">UIScreen</span>.main.bounds.width-<span class="number">60</span>, height: <span class="type">UIScreen</span>.main.bounds.height-<span class="number">160</span>))</span><br><span class="line">        web.delegate = <span class="keyword">self</span></span><br><span class="line">        <span class="keyword">return</span> web</span><br><span class="line">    &#125;()</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        view.backgroundColor = <span class="type">UIColor</span>.white</span><br><span class="line">        view.addSubview(webView)</span><br><span class="line"><span class="comment">//        let url = URL(string: "https://www..com")!</span></span><br><span class="line">        <span class="keyword">let</span> url = <span class="type">Bundle</span>.main.url(forResource:<span class="string">"index"</span>, withExtension:<span class="string">"html"</span>)!</span><br><span class="line">        webView.loadRequest(<span class="type">URLRequest</span>(url: url))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MARK: ä»£ç† UIWebViewDelegate</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ViewController</span>: <span class="title">UIWebViewDelegate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">webViewDidFinishLoad</span><span class="params">(<span class="number">_</span> webView: UIWebView)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(#function)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> context = webView.value(forKeyPath: <span class="string">"documentView.webView.mainFrame.javaScriptContext"</span>)</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> jsContext = context <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">        <span class="keyword">let</span> jscontext = jsContext <span class="keyword">as</span>! <span class="type">JSContext</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> block: <span class="meta">@convention</span>(block) () -&gt; () = &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"CurrentThread: <span class="subst">\(Thread.current)</span>"</span>) <span class="comment">//æ­¤Closureæ˜¯å­çº¿ç¨‹</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// è·å–jså‡½æ•°ä¼ å…¥çš„å‚æ•°</span></span><br><span class="line">            <span class="keyword">let</span> args = <span class="type">JSContext</span>.currentArguments()</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> argments = args <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">            <span class="keyword">var</span> i = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> item <span class="keyword">in</span> argments &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"args[<span class="subst">\(i)</span>]: <span class="subst">\(item)</span>"</span>)</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// ä½¿ç”¨JSContextæ‰§è¡ŒJSä»£ç ï¼Œå°†JSä¼ é€’ç»™OC/Swiftçš„æ•°æ®ï¼Œä¼ é€’å›JS</span></span><br><span class="line">            <span class="comment">//æ–¹æ³•ä¸€ï¼š</span></span><br><span class="line"><span class="comment">//            JSContext.current().evaluateScript("showAlert('\(argments[0])')")</span></span><br><span class="line">            <span class="comment">//æ–¹æ³•äºŒï¼š</span></span><br><span class="line">            <span class="type">JSContext</span>.current().objectForKeyedSubscript(<span class="string">"showAlert"</span>).call(withArguments: argments)</span><br><span class="line"><span class="comment">//            JSContext.current().objectForKeyedSubscript("alert").call(withArguments: argments)</span></span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">            <span class="comment">// ä¿®æ”¹åŸç”ŸUI</span></span><br><span class="line">            <span class="type">DispatchQueue</span>.main.async &#123; <span class="comment">//å›åˆ°ä¸»çº¿ç¨‹</span></span><br><span class="line">                <span class="keyword">self</span>!.view.backgroundColor = <span class="type">UIColor</span>.orange</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// BOMæ“ä½œ</span></span><br><span class="line"><span class="comment">//                self!.webView.reload()</span></span><br><span class="line"><span class="comment">//                self!.webView.goForward()</span></span><br><span class="line"><span class="comment">//                self!.webView.goBack()</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// æ’­æ”¾ç³»ç»ŸéŸ³æ•ˆ</span></span><br><span class="line">            <span class="type">AudioServicesPlaySystemSound</span>(<span class="number">1007</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">             æ­¤å¤„å¯ä»¥æ‰§è¡Œçš„ä»»åŠ¡ï¼š</span></span><br><span class="line"><span class="comment">                 è·å–åœ°ç†ä½ç½®ä¿¡æ¯ã€è°ƒç”¨ç›¸æœºã€æ‰«ä¸€æ‰«äºŒç»´ç ã€è°ƒç”¨ç³»ç»Ÿåˆ†äº«é¢æ¿ã€æ›´æ”¹åŸç”Ÿæ§ä»¶å±æ€§æ ·å¼ï¼ˆå›åˆ°ä¸»çº¿ç¨‹ï¼‰ã€</span></span><br><span class="line"><span class="comment">                 åŸç”Ÿè°ƒç”¨æ”¯ä»˜ï¼ˆJSæŠŠæ”¯ä»˜å‚æ•°ä¼ é€’ç»™OC/Swfitè¿›è¡Œæ”¯ä»˜ã€OC/SwfitæŠŠæ”¯ä»˜ç»“æœåé¦ˆç»™JSï¼‰ã€</span></span><br><span class="line"><span class="comment">                 æ‘‡ä¸€æ‘‡ã€æ’­æ”¾ç³»ç»ŸéŸ³æ•ˆã€</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">        &#125;</span><br><span class="line">        jscontext.setObject(block, forKeyedSubscript: <span class="type">NSString</span>(string: <span class="string">"handleJSToiOS"</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="JSVirtualMachine"><a href="#JSVirtualMachine" class="headerlink" title="JSVirtualMachine"></a>JSVirtualMachine</h2><blockquote>
<p><code>JSVirtualMachine</code>ä¸º<code>JS</code>è„šæœ¬çš„æ‰§è¡Œæä¾›åº•å±‚èµ„æºã€‚ä¸€ä¸ª<code>JSVirtualMachine</code>å®ä¾‹ï¼Œä»£è¡¨ä¸€ä¸ªç‹¬ç«‹çš„<code>JS</code>å¯¹è±¡ç©ºé—´ï¼Œå¹¶ä¸ºå…¶æ‰§è¡Œæä¾›èµ„æºã€‚å®ƒé€šè¿‡åŠ é”ï¼Œä¿è¯<code>JSVirtualMachine</code>æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¦‚æœè¦å¹¶å‘æ‰§è¡Œ<code>JS</code>ï¼Œé‚£æˆ‘ä»¬å¿…é¡»åˆ›å»ºå¤šä¸ªç‹¬ç«‹çš„<code>JSVirtualMachine</code>å®ä¾‹ï¼Œåœ¨ä¸åŒçš„å®ä¾‹ä¸­æ‰§è¡Œ<code>JS</code>ï¼ˆæœ‰ç‚¹åƒJSå¼•æ“ï¼Œå¦‚V8ï¼‰ã€‚æœ‰ç‹¬ç«‹çš„å †ç©ºé—´å’Œåƒåœ¾å›æ”¶æœºåˆ¶ã€‚å¤„ç†çº¿ç¨‹ç›¸å…³ï¼Œä½¿ç”¨è¾ƒå°‘ã€‚</p>
</blockquote>
<p>é€šè¿‡<code>alloc/init</code>å°±å¯ä»¥åˆ›å»ºä¸€ä¸ª<code>JSVirtualMachine</code>å¯¹è±¡ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸€èˆ¬ä¸ç”¨æ–°å»º<code>JSVirtualMachine</code>å¯¹è±¡ï¼Œå› ä¸ºåˆ›å»º<code>JSContext</code>æ—¶ï¼Œå¦‚æœæˆ‘ä»¬ä¸æä¾›ä¸€ä¸ªè‡ªå·±åˆ›å»ºçš„<code>JSVirtualMachine</code>ï¼Œå†…éƒ¨ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª<code>JSVirtualMachine</code>å¯¹è±¡ã€‚<code>JSContext</code>å¯¹è±¡ç®¡ç†<code>JSVirtualMachine</code>å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚</p>
<p><code>JSVirtualMachine</code>åˆ›å»ºæ–¹å¼ï¼š<br>æ–¹å¼ä¸€ï¼Œåˆ›å»º<code>JSContext</code>å¯¹è±¡æ—¶ï¼Œå†…éƒ¨è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ–°çš„<code>JSVirtualMachine</code>å¯¹è±¡ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//OC</span><br><span class="line">JSContext *context = [[JSContext alloc] init];</span><br></pre></td></tr></table></figure></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Swift</span></span><br><span class="line"><span class="keyword">let</span> context = <span class="type">JSContext</span>()</span><br></pre></td></tr></table></figure>
<p>æ–¹å¼äºŒï¼Œè‡ªå·±åˆ›å»ºä¸€ä¸ª<code>JSVirtualMachine</code>å¯¹è±¡ï¼Œä¼ å…¥çš„åˆ›å»º<code>JSContext</code>å¯¹è±¡ä¸­ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//OC</span><br><span class="line">JSVirtualMachine *jsVM = [[JSVirtualMachine alloc] init];</span><br><span class="line">JSContext *context = [[JSContext alloc] initWithVirtualMachine:jsVM]; //ä¼ å…¥çš„JSVirtualMachineå¯¹è±¡ä¸èƒ½ä¸ºç©º</span><br></pre></td></tr></table></figure></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Swift</span></span><br><span class="line"><span class="keyword">let</span> jsVM = <span class="type">JSVirtualMachine</span>()</span><br><span class="line"><span class="keyword">let</span> <span class="built_in">c</span> = <span class="type">JSContext</span>(virtualMachine: jsVM)</span><br></pre></td></tr></table></figure>
<p><code>JSVirtualMachine</code>ä¸º<code>JavaScript</code>çš„è¿è¡Œ<strong>æä¾›äº†åº•å±‚èµ„æº</strong>ï¼Œ<code>JSContext</code>ä¸º<code>JavaScript</code><strong>æä¾›äº†è¿è¡Œç¯å¢ƒ</strong>;<br>è€Œ<code>JSContext</code>çš„åˆ›å»ºéƒ½æ˜¯åŸºäº<code>JSVirtualMachine</code>ã€‚<br><code>JSValue</code>å…¶å®å°±æ˜¯<code>JS</code>å¯¹è±¡åœ¨<code>JSVirtualMachine</code>ä¸­çš„ä¸€ä¸ªå¼ºå¼•ç”¨ã€‚</p>
<p>=================<br>æœ¬æ–‡ä»£ç ï¼Œæˆ‘çš„<code>Github</code>ä»“åº“è·å–<a href="https://github.com/MengYP/apple-stack/tree/master/iOS_JavaScript/iOS-callJavaScript" target="_blank" rel="noopener">apple-stack</a></p>
<p>=================<br>2017.7æ›´æ–°</p>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>ğŸ¶ å®¢è§‚èµä¸ªå¥½è¯„å§ ğŸ¶</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>æ‰“èµ</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/uploads/wechatpay.png" alt="å­Ÿè·ƒå¹³ å¾®ä¿¡æ”¯ä»˜"/>
        <p>å¾®ä¿¡æ”¯ä»˜</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/uploads/alipay.png" alt="å­Ÿè·ƒå¹³ æ”¯ä»˜å®"/>
        <p>æ”¯ä»˜å®</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/iOS/" rel="tag"># iOS</a>
          
            <a href="/tags/Swift/" rel="tag"># Swift</a>
          
            <a href="/tags/OC/" rel="tag"># OC</a>
          
            <a href="/tags/JavaScript/" rel="tag"># JavaScript</a>
          
            <a href="/tags/JavaScriptCore/" rel="tag"># JavaScriptCore</a>
          
            <a href="/tags/UIWebView/" rel="tag"># UIWebView</a>
          
            <a href="/tags/WKWebView/" rel="tag"># WKWebView</a>
          
            <a href="/tags/HTML/" rel="tag"># HTML</a>
          
            <a href="/tags/WebKit/" rel="tag"># WebKit</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/07/02/iOS-JSExport-JSCallOC-Swift/" rel="prev" title="JSExportå®ç°JSè°ƒç”¨OC/Swift">
                JSExportå®ç°JSè°ƒç”¨OC/Swift <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
        
<script>
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='//bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/uploads/avatar.png"
                alt="å­Ÿè·ƒå¹³" />
            
              <p class="site-author-name" itemprop="name">å­Ÿè·ƒå¹³</p>
              <p class="site-description motion-element" itemprop="description">stay hungry, stay foolish</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">æ—¥å¿—</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">åˆ†ç±»</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">41</span>
                  <span class="site-state-item-name">æ ‡ç­¾</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/MengYP" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:mengcoder@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#OC-Swiftä¸JavaScriptäº¤äº’"><span class="nav-number">1.</span> <span class="nav-text">OC/Swiftä¸JavaScriptäº¤äº’</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#é—®é¢˜"><span class="nav-number">1.1.</span> <span class="nav-text">é—®é¢˜</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#iOSä¸­åŠ è½½HTMLé¡µé¢"><span class="nav-number">2.</span> <span class="nav-text">iOSä¸­åŠ è½½HTMLé¡µé¢</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#UIWebView"><span class="nav-number">2.1.</span> <span class="nav-text">UIWebView</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#OCç‰ˆæœ¬"><span class="nav-number">2.1.1.</span> <span class="nav-text">OCç‰ˆæœ¬</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Swiftç‰ˆæœ¬"><span class="nav-number">2.1.2.</span> <span class="nav-text">Swiftç‰ˆæœ¬</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WKWebView"><span class="nav-number">2.2.</span> <span class="nav-text">WKWebView</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#OCç‰ˆæœ¬-1"><span class="nav-number">2.2.1.</span> <span class="nav-text">OCç‰ˆæœ¬</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Swiftç‰ˆæœ¬-1"><span class="nav-number">2.2.2.</span> <span class="nav-text">Swiftç‰ˆæœ¬</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#iOSä¸­æ‰§è¡Œä¸€æ®µJavaScriptä»£ç "><span class="nav-number">3.</span> <span class="nav-text">iOSä¸­æ‰§è¡Œä¸€æ®µJavaScriptä»£ç </span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ä½¿ç”¨UIWebViewæ‰§è¡ŒJSä»£ç "><span class="nav-number">3.1.</span> <span class="nav-text">ä½¿ç”¨UIWebViewæ‰§è¡ŒJSä»£ç </span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#OCç‰ˆæœ¬-2"><span class="nav-number">3.1.1.</span> <span class="nav-text">OCç‰ˆæœ¬</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Swiftç‰ˆæœ¬-2"><span class="nav-number">3.1.2.</span> <span class="nav-text">Swiftç‰ˆæœ¬</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ä½¿ç”¨WKWebViewæ‰§è¡ŒJSä»£ç "><span class="nav-number">3.2.</span> <span class="nav-text">ä½¿ç”¨WKWebViewæ‰§è¡ŒJSä»£ç </span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#OCç‰ˆæœ¬-3"><span class="nav-number">3.2.1.</span> <span class="nav-text">OCç‰ˆæœ¬</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Swiftç‰ˆæœ¬-3"><span class="nav-number">3.2.2.</span> <span class="nav-text">Swiftç‰ˆæœ¬</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#iOSä¸­ç›‘å¬JavaScriptå‡½æ•°è°ƒç”¨"><span class="nav-number">4.</span> <span class="nav-text">iOSä¸­ç›‘å¬JavaScriptå‡½æ•°è°ƒç”¨</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ä½¿ç”¨UIWebViewç›‘å¬JSå‡½æ•°è°ƒç”¨"><span class="nav-number">4.1.</span> <span class="nav-text">ä½¿ç”¨UIWebViewç›‘å¬JSå‡½æ•°è°ƒç”¨</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#OCç‰ˆæœ¬-4"><span class="nav-number">4.1.1.</span> <span class="nav-text">OCç‰ˆæœ¬</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Swiftç‰ˆæœ¬-4"><span class="nav-number">4.1.2.</span> <span class="nav-text">Swiftç‰ˆæœ¬</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ä½¿ç”¨WKWebViewç›‘å¬JSå‡½æ•°è°ƒç”¨"><span class="nav-number">4.2.</span> <span class="nav-text">ä½¿ç”¨WKWebViewç›‘å¬JSå‡½æ•°è°ƒç”¨</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#OCç‰ˆæœ¬-5"><span class="nav-number">4.2.1.</span> <span class="nav-text">OCç‰ˆæœ¬</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Swiftç‰ˆæœ¬-5"><span class="nav-number">4.2.2.</span> <span class="nav-text">Swiftç‰ˆæœ¬</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WKWebViewä¸JSä¹‹é—´çš„é€šä¿¡"><span class="nav-number">4.3.</span> <span class="nav-text">WKWebViewä¸JSä¹‹é—´çš„é€šä¿¡</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#OCç‰ˆæœ¬-6"><span class="nav-number">4.3.1.</span> <span class="nav-text">OCç‰ˆæœ¬</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Swiftç‰ˆæœ¬-6"><span class="nav-number">4.3.2.</span> <span class="nav-text">Swiftç‰ˆæœ¬</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#iOSä¸­åˆ©ç”¨JavaScriptCoreäº¤äº’JS"><span class="nav-number">5.</span> <span class="nav-text">iOSä¸­åˆ©ç”¨JavaScriptCoreäº¤äº’JS</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ä½¿ç”¨JSContextè¿è¡ŒJSä»£ç "><span class="nav-number">5.1.</span> <span class="nav-text">ä½¿ç”¨JSContextè¿è¡ŒJSä»£ç </span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#åˆå§‹åŒ–JSContextå¯¹è±¡åŠå¼‚å¸¸å¤„ç†"><span class="nav-number">5.1.1.</span> <span class="nav-text">åˆå§‹åŒ–JSContextå¯¹è±¡åŠå¼‚å¸¸å¤„ç†</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#OCç‰ˆæœ¬-7"><span class="nav-number">5.1.1.1.</span> <span class="nav-text">OCç‰ˆæœ¬</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Swiftç‰ˆæœ¬-7"><span class="nav-number">5.1.1.2.</span> <span class="nav-text">Swiftç‰ˆæœ¬</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ‰§è¡Œå¸¦è¿”å›ç»“æœjsè„šæœ¬"><span class="nav-number">5.1.2.</span> <span class="nav-text">æ‰§è¡Œå¸¦è¿”å›ç»“æœjsè„šæœ¬</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#OCç‰ˆæœ¬-8"><span class="nav-number">5.1.2.1.</span> <span class="nav-text">OCç‰ˆæœ¬</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Swiftç‰ˆæœ¬-8"><span class="nav-number">5.1.2.2.</span> <span class="nav-text">Swiftç‰ˆæœ¬</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ‰§è¡Œä¸å¸¦è¿”å›ç»“æœjsè„šæœ¬"><span class="nav-number">5.1.3.</span> <span class="nav-text">æ‰§è¡Œä¸å¸¦è¿”å›ç»“æœjsè„šæœ¬</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#OCç‰ˆæœ¬-9"><span class="nav-number">5.1.3.1.</span> <span class="nav-text">OCç‰ˆæœ¬</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Swiftç‰ˆæœ¬-9"><span class="nav-number">5.1.3.2.</span> <span class="nav-text">Swiftç‰ˆæœ¬</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å–å‡ºjsè„šæœ¬æ‰§è¡Œåå­˜å‚¨åœ¨JSContextå¯¹è±¡ä¸­çš„å˜é‡"><span class="nav-number">5.1.4.</span> <span class="nav-text">å–å‡ºjsè„šæœ¬æ‰§è¡Œåå­˜å‚¨åœ¨JSContextå¯¹è±¡ä¸­çš„å˜é‡</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#OCç‰ˆæœ¬-10"><span class="nav-number">5.1.4.1.</span> <span class="nav-text">OCç‰ˆæœ¬</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Swiftç‰ˆæœ¬-10"><span class="nav-number">5.1.4.2.</span> <span class="nav-text">Swiftç‰ˆæœ¬</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å–å‡ºå­˜å‚¨çš„jså˜é‡ï¼Œå¹¶ä¿®æ”¹"><span class="nav-number">5.1.5.</span> <span class="nav-text">å–å‡ºå­˜å‚¨çš„jså˜é‡ï¼Œå¹¶ä¿®æ”¹</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#OCç‰ˆæœ¬-11"><span class="nav-number">5.1.5.1.</span> <span class="nav-text">OCç‰ˆæœ¬</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Swiftç‰ˆæœ¬-11"><span class="nav-number">5.1.5.2.</span> <span class="nav-text">Swiftç‰ˆæœ¬</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å–å‡ºå­˜å‚¨çš„jsé›†åˆå¯¹è±¡ï¼Œå¹¶è½¬ä¸ºOCæ•°ç»„å¯¹è±¡"><span class="nav-number">5.1.6.</span> <span class="nav-text">å–å‡ºå­˜å‚¨çš„jsé›†åˆå¯¹è±¡ï¼Œå¹¶è½¬ä¸ºOCæ•°ç»„å¯¹è±¡</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#OCç‰ˆæœ¬-12"><span class="nav-number">5.1.6.1.</span> <span class="nav-text">OCç‰ˆæœ¬</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Swiftç‰ˆæœ¬-12"><span class="nav-number">5.1.6.2.</span> <span class="nav-text">Swiftç‰ˆæœ¬</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å–å‡ºå­˜å‚¨çš„jsé›†åˆå¯¹è±¡ï¼Œå¹¶ç›´æ¥ä½¿ç”¨OCå¯¹è±¡ç»™jså¯¹è±¡èµ‹å€¼"><span class="nav-number">5.1.7.</span> <span class="nav-text">å–å‡ºå­˜å‚¨çš„jsé›†åˆå¯¹è±¡ï¼Œå¹¶ç›´æ¥ä½¿ç”¨OCå¯¹è±¡ç»™jså¯¹è±¡èµ‹å€¼</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#OCç‰ˆæœ¬-13"><span class="nav-number">5.1.7.1.</span> <span class="nav-text">OCç‰ˆæœ¬</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Swiftç‰ˆæœ¬-13"><span class="nav-number">5.1.7.2.</span> <span class="nav-text">Swiftç‰ˆæœ¬</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å–å‡ºå­˜å‚¨çš„jså‡½æ•°ï¼Œå¹¶æ‰§è¡Œ"><span class="nav-number">5.1.8.</span> <span class="nav-text">å–å‡ºå­˜å‚¨çš„jså‡½æ•°ï¼Œå¹¶æ‰§è¡Œ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#OCç‰ˆæœ¬-14"><span class="nav-number">5.1.8.1.</span> <span class="nav-text">OCç‰ˆæœ¬</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Swiftç‰ˆæœ¬-14"><span class="nav-number">5.1.8.2.</span> <span class="nav-text">Swiftç‰ˆæœ¬</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è°ƒç”¨jså‡½æ•°çš„å¦ä¸€ç§ç®€å•æ–¹æ³•"><span class="nav-number">5.1.9.</span> <span class="nav-text">è°ƒç”¨jså‡½æ•°çš„å¦ä¸€ç§ç®€å•æ–¹æ³•</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#OCç‰ˆæœ¬-15"><span class="nav-number">5.1.9.1.</span> <span class="nav-text">OCç‰ˆæœ¬</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Swiftç‰ˆæœ¬-15"><span class="nav-number">5.1.9.2.</span> <span class="nav-text">Swiftç‰ˆæœ¬</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æŠŠOCä¸­Blockè½¬æ¢æˆJSå‡½æ•°ï¼Œå¹¶å­˜å‚¨åˆ°JSContextå¯¹è±¡"><span class="nav-number">5.1.10.</span> <span class="nav-text">æŠŠOCä¸­Blockè½¬æ¢æˆJSå‡½æ•°ï¼Œå¹¶å­˜å‚¨åˆ°JSContextå¯¹è±¡</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#OCç‰ˆæœ¬-16"><span class="nav-number">5.1.10.1.</span> <span class="nav-text">OCç‰ˆæœ¬</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Swiftç‰ˆæœ¬-16"><span class="nav-number">5.1.10.2.</span> <span class="nav-text">Swiftç‰ˆæœ¬</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JSContextç»“åˆUIWebViewå¤„ç†HTMLä¸­äº‹ä»¶ç›‘å¬"><span class="nav-number">5.2.</span> <span class="nav-text">JSContextç»“åˆUIWebViewå¤„ç†HTMLä¸­äº‹ä»¶ç›‘å¬</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#åŠ è½½çš„HTML"><span class="nav-number">5.2.1.</span> <span class="nav-text">åŠ è½½çš„HTML</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OCç‰ˆæœ¬-17"><span class="nav-number">5.2.2.</span> <span class="nav-text">OCç‰ˆæœ¬</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Swiftç‰ˆæœ¬-17"><span class="nav-number">5.2.3.</span> <span class="nav-text">Swiftç‰ˆæœ¬</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JSVirtualMachine"><span class="nav-number">5.3.</span> <span class="nav-text">JSVirtualMachine</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2015 &mdash; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">å­Ÿè·ƒå¹³</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  

    
      <script id="dsq-count-scr" src="https://.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'http://www.mengyueping.com/2016/10/16/iOS-callJavaScript/';
          this.page.identifier = '2016/10/16/iOS-callJavaScript/';
          this.page.title = 'Objective-C/Swiftä¸JavaScriptäº¤äº’';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  





  












  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("bSSS0Dg4QVv1p0FAHGaWv8Ei-gzGzoHsz", "UcKuDEryAx1QLVWeFLQHrUns");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  

</body>
</html>
